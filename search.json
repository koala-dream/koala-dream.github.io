[{"title":"å„ç§å­ç³»ç»Ÿè®¾å¤‡æ ‘ï¼Œé©±åŠ¨åŒ¹é…æ–¹å¼","url":"/2026/02/11/2026-2-11-%E5%90%84%E7%A7%8D%E5%AD%90%E7%B3%BB%E7%BB%9F%E8%AE%BE%E5%A4%87%E6%A0%91%EF%BC%8C%E9%A9%B1%E5%8A%A8%E5%8C%B9%E9%85%8D%E6%96%B9%E5%BC%8F/","content":"ä¸€ä¸ªé©±åŠ¨ç¨‹åºåŠ è½½æ—¶ï¼Œå†…æ ¸ä¼šè°ƒç”¨driver_match_deviceï¼Œæ ¹æ®é©±åŠ¨çš„æ€»çº¿busç±»å‹ï¼Œè°ƒç”¨å¯¹åº”çš„matchå‡½æ•°\nå°ç™½è¯·æ³¨æ„ï¼šä¸åŒçš„å­ç³»ç»Ÿé©±åŠ¨æ¡†æ¶ï¼Œéƒ½ä¼šæœ‰è‡ªå·±çš„åŒ¹é…å‡½æ•°matchï¼Œå„æœ‰ç‰¹ç‚¹\nstatic inline int driver_match_device(struct device_driver *drv,struct device *dev)&#123;\treturn drv-&gt;bus-&gt;match ? drv-&gt;bus-&gt;match(dev, drv) : 1;&#125;\n\n\n\nå¦‚æœæ˜¯å¹³å°æ€»çº¿é©±åŠ¨ï¼Œå°±ä¼šè°ƒç”¨platform_matchï¼Œè¿›è¡ŒåŒ¹é…\nstatic int platform_match(struct device *dev, struct device_driver *drv)&#123;\tstruct platform_device *pdev = to_platform_device(dev);\tstruct platform_driver *pdrv = to_platform_driver(drv);\t/* \t\tä¸¾ä¾‹ï¼šcd /sys/bus/platform/devices/gundam_ds18b20ä¸‹ï¼Œæœ‰ä¸€ä¸ªdriver_overrideå±æ€§\t\tå¯ä»¥åœ¨ç»ˆç«¯echoé©±åŠ¨çš„nameï¼Œå°±èƒ½å¼ºåˆ¶ä¸æŸä¸€ä¸ªé©±åŠ¨è¿›è¡ŒåŒ¹é…     */\tif (pdev-&gt;driver_override)\t\treturn !strcmp(pdev-&gt;driver_override, drv-&gt;name);\t/* åœ¨è¿™é‡Œå°è¯•ä½¿ç”¨è®¾å¤‡æ ‘åŒ¹é… */\tif (of_driver_match_device(dev, drv))\t\treturn 1;\t/* Then try ACPI style match  è¿™ä¸ªæ˜¯x86jia&#x27;g&#x27;pouä½¿ç”¨çš„åŒ¹é…ï¼Œä¸ç®¡ */\tif (acpi_driver_match_device(dev, drv))\t\treturn 1;\t/* é©±åŠ¨ä¸­çš„compatibleåŒ¹é…ä¸æˆç‹—ï¼Œå°±ç”¨ id table */\tif (pdrv-&gt;id_table)\t\treturn platform_match_id(pdrv-&gt;id_table, pdev) != NULL;\t/* æœ€åå°è¯•ä½¿ç”¨platform_deviceçš„åå­—ä¸driverçš„åå­—è¿›è¡ŒåŒ¹é… */\treturn (strcmp(pdev-&gt;name, drv-&gt;name) == 0);&#125;\n\nè¦æƒ³ç»§ç»­ç ”ç©¶å…·ä½“æ˜¯æ€ä¹ˆåŒ¹é…çš„ï¼Œå¾—å…ˆäº†è§£ä¼ è¿›å»çš„å‚æ•°åˆ†åˆ«éƒ½æœ‰ä»€ä¹ˆä¿¡æ¯\n/* platform_device */struct platform_device &#123;\tconst char\t*name;\t\t// ä¸¾ä¾‹ï¼šè®¾å¤‡æ ‘ä¸­gundam_gt911@14ç»“ç‚¹ï¼Œnameå°±æ˜¯gundam_gt911    \tstruct device\tdev;    \tconst struct platform_device_id\t*id_entry;\t\tchar *driver_override; /* Driver name to force a match */\t..................æ­¤å¤„çœç•¥ä¸åŒ¹é…æ— å…³çš„æˆå‘˜&#125;;/* device */struct device &#123;\tstruct device\t\t*parent;\t\tstruct kobject kobj;\t\tconst struct device_type *type;\tstruct bus_type\t*bus;\t\t/* type of bus device is on */\t\t\t\t\t   \tstruct device_node\t\t*of_node; /* associated device tree node */\tstruct fwnode_handle\t*fwnode; /* firmware device node */\tdev_t\t\tdevt;\t/* dev_t, creates the sysfs &quot;dev&quot; */\tu32\t\t\tid;\t\t\t/* device instance */\t\t\t..................æ­¤å¤„çœç•¥ä¸åŒ¹é…æ— å…³çš„æˆå‘˜&#125;;/* device_node */struct device_node &#123;\tconst char *name;\tconst char *type;\tconst char *full_name;\tstruct\tproperty *properties;\t..................æ­¤å¤„çœç•¥ä¸åŒ¹é…æ— å…³çš„æˆå‘˜&#125;;/* propertyï¼šè´¢äº§ï¼Œä¸€ä¸ªdevice_nodeæœ‰å¾ˆå¤šä¸ªè´¢äº§ï¼Œæ¯”æ–¹è¯´compatibleå±æ€§å°±æ˜¯å…¶ä¸­ä¸€ä¸ªproperty */struct property &#123;\tchar\t*name;\t\t// ä¸¾ä¾‹ï¼šname = compatible\tint\t\tlength;\t\t\tvoid\t*value;\t\t// value = &quot;gundam,ds18b20&quot; \t\t..................æ­¤å¤„çœç•¥ä¸åŒ¹é…æ— å…³çš„æˆå‘˜&#125;;\n\n\n\n/* platform_driver */struct platform_driver &#123;\tstruct device_driver driver;\tconst struct platform_device_id *id_table;\t    ..................æ­¤å¤„çœç•¥ä¸åŒ¹é…æ— å…³çš„æˆå‘˜&#125;;/* device_driver */struct device_driver &#123;\tconst char\t\t\t*name;\tstruct bus_type\t\t*bus;\tconst struct of_device_id\t*of_match_table;\t\t..................æ­¤å¤„çœç•¥ä¸åŒ¹é…æ— å…³çš„æˆå‘˜&#125;;/* of_device_id */struct of_device_id &#123;\tchar\tname[32];\t\t\t// ä¸€èˆ¬éƒ½è®¾ä¸ºNULLï¼Œè™½ç„¶ä¹Ÿèƒ½ç”¨è¿™ç§åŒ¹é…ï¼Œä½†æ˜¯æ²¡äººç”¨äº†\tchar\ttype[32];\t\t\t// ä¸€èˆ¬éƒ½è®¾ä¸ºNULLï¼ŒåŒä¸Šç†\tchar\tcompatible[128];\t// å†™é©±åŠ¨ç¨‹åºçš„æ—¶å€™ä¸€èˆ¬åªå¡«å……è¿™ä¸ª\t\t..................æ­¤å¤„çœç•¥ä¸åŒ¹é…æ— å…³çš„æˆå‘˜&#125;;/* platform_device_id */struct platform_device_id &#123;\tchar name[PLATFORM_NAME_SIZE];\tkernel_ulong_t driver_data;&#125;;\n\n\n\næ–¹æ³•1ï¼šè®¾å¤‡æ ‘ä¸­çš„compatibleå±æ€§å’Œé©±åŠ¨ä¸­çš„ï¼ˆdevice_driver-&gt;of_match_table-&gt;compatibleï¼‰å®Œå…¨åŒ¹é…\næ–¹æ³•2ï¼šå¼ºåˆ¶å†™&#x2F;sys&#x2F;bus&#x2F;platform&#x2F;devices&#x2F;gundam_ds18b20&#x2F;driver_overrideçš„å†…å®¹ï¼Œæ”¹ä¸ºé©±åŠ¨åå­—ï¼ˆdevice_driver-&gt;nameï¼‰\næ–¹æ³•3ï¼šé©±åŠ¨çš„id_tableè¡¨ï¼Œä¸è®¾å¤‡æ ‘ç»“ç‚¹çš„åå­—ï¼ˆplatform_device-&gt;nameï¼‰å®Œå…¨åŒ¹é…\næ–¹æ³•4ï¼šè®¾å¤‡æ ‘ç»“ç‚¹çš„åå­—ï¼ˆplatform_device-&gt;nameï¼‰ä¸é©±åŠ¨åå­—ï¼ˆdevice_driver-&gt;nameï¼‰åŒ¹é…\nå¤‡æ³¨ï¼šè®¾å¤‡æ ‘ç»“ç‚¹åå­—çš„è®¡ç®—æ–¹æ³•ï¼Œæ¯”æ–¹è¯´gundam_gt911@14ï¼Œå®ƒçš„åå­—å°±æ˜¯gundam_gt911\n","categories":["Linux è®¾å¤‡æ ‘"],"tags":["è®¾å¤‡æ ‘"]},{"title":"es8311å£°å¡è°ƒè¯•è®°å½•","url":"/2026/02/12/2026-2-12-es8311%E5%A3%B0%E5%8D%A1%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/","content":"","categories":["Linux å£°å¡é©±åŠ¨"],"tags":["I2S"]},{"title":"I2CåŸºç¡€çŸ¥è¯†","url":"/2026/01/26/2026-1-26-I2C%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/","content":"ç®€è¿°I2Cæ€»çº¿çš„åŸºæœ¬åŸç†ã€‚ (æç¤ºï¼šä¸¤çº¿åˆ¶ã€åŒæ­¥ã€åŠåŒå·¥ã€å¤šä¸»å¤šä»ã€åœ°å€å¯»å€)\n\n(1)     IICä½¿ç”¨SCLå’ŒSDAä¸¤æ ¹çº¿ï¼ŒSCLç”¨äºåŒæ­¥ï¼ŒSDAè´Ÿè´£æ•°æ®ä¼ è¾“\n(2)    æ˜¯åŠåŒå·¥æœºåˆ¶ï¼ˆä¸»ä»æœºä¹‹é—´ä¸èƒ½åŒæ—¶ä¼ è¾“æ•°æ®ã€‚ï¼‰\n(3)    IICæ˜¯å¤šä¸»å¤šä»çš„åè®®\n(4)    åœ°å€å¯»å€å¯ä»¥è¦ä¹ˆ7ä½åœ°å€ï¼Œè¦ä¹ˆ10ä½åœ°å€\nğŸ”´ é‡è¦å†…å®¹\n\nä¸ºä»€ä¹ˆI2Cæ€»çº¿éœ€è¦ä¸Šæ‹‰ç”µé˜»ï¼Ÿå…¶é˜»å€¼å¦‚ä½•é€‰æ‹©ï¼Ÿ(1)    å› ä¸ºéœ€è¦å®ç°å¤šä»æœºçš„æœºåˆ¶ï¼ŒIICçš„å¼•è„šéœ€è¦ä½¿ç”¨å¼€æ¼æ¨¡å¼æŒ‚è½½åˆ°IICæ€»çº¿ä¸Šï¼Œå¼€æ¼æ¨¡å¼ä¸‹çš„é«˜ç”µå¹³ç”±ä¸Šæ‹‰ç”µé˜»å®ç°ã€‚å¦‚æœä¸ä½¿ç”¨å¼€æ¼è¾“å‡ºæ¨¡å¼ï¼Œå½“ä¸»æœºè®¿é—®ä»æœº1æ—¶ï¼Œä»æœº1æ‹‰ä½æ€»çº¿ç”µå¹³ï¼Œè€Œä»æœº2ä¼šè¾“å‡ºé«˜ç”µå¹³ï¼Œè¡¨ç¤ºä¸åº”ç­”ï¼Œä½†æ˜¯è¿™æ ·çš„è¯ï¼Œä¼šä½¿å¾—æ€»çº¿çŸ­è·¯ã€‚å¼€æ¼æ¨¡å¼ä¸‹ï¼Œä»æœº2é‡Šæ”¾æ€»çº¿ï¼ˆè¾“å‡ºé«˜é˜»æ€ï¼‰ï¼Œä¸ä¼šå½±å“åˆ°ä»æœº1çš„æ‹‰ä½ï¼Œå› ä¸ºä¸Šæ‹‰ç”µé˜»çš„å­˜åœ¨ï¼Œæ€»çº¿ä¸ä¼šçŸ­è·¯ã€‚\n(2)    æ ¹æ®IICåè®®çš„é€Ÿåº¦éœ€æ±‚é€‰æ‹©é˜»å€¼\nstruct power_supply_config &#123;    struct device_node *of_node;  // è®¾å¤‡èŠ‚ç‚¹    struct fwnode_handle *fwnode; // fwnode èŠ‚ç‚¹    void *drv_data; // ç§æœ‰æ•°æ®    const struct attribute_group **attr_grp; // ç§æœ‰çš„å±æ€§èŠ‚ç‚¹    char **supplied_to;  // ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„, ä¿å­˜äº†è¯¥ psy å‘ä¸‹ä¸€çº§ä¾›ç”µçš„ psy åˆ—è¡¨. ç»„ç»‡ psy ä¹‹é—´çš„çº§è”æ–¹å‘.    size_t num_supplicants;    ANDROID_KABI_RESERVE(1);&#125;;\n\n\n\nè¯¦ç»†æè¿°I2Cé€šä¿¡çš„æ—¶åºï¼šèµ·å§‹æ¡ä»¶ã€åœæ­¢æ¡ä»¶ã€æ•°æ®æœ‰æ•ˆæ€§åŠåº”ç­”æœºåˆ¶ã€‚(1)    èµ·å§‹ä¿¡å·ï¼šå½“SCLå¤„äºé«˜ç”µå¹³æ—¶ï¼ŒSDAç»™å‡ºä»é«˜åˆ°ä½çš„ä¸‹é™æ²¿ç”µå¹³\n(2)    åœæ­¢ä¿¡å·ï¼šå½“SCLå¤„äºé«˜ç”µå¹³æ—¶ï¼ŒSDAç»™å‡ºä»ä½åˆ°é«˜çš„ä¸Šå‡æ²¿ç”µå¹³\n(3)    å½“SCLå¤„äºä½ç”µå¹³æ—¶ï¼Œå¯ä»¥æ”¹å˜SDAçš„å€¼ï¼ŒSCLå¤„äºé«˜ç”µå¹³æ—¶ï¼Œå¯ä»¥è¿›è¡Œé‡‡æ ·\n(4)    åœ¨æ¥æ”¶å®Œä¸€å¸§æ•°æ®åï¼Œä»æœº&#x2F;ä¸»æœºåº”å½“é€‰æ‹©æ‹‰ä½SDAæ€»çº¿è¿›è¡Œåº”ç­”ï¼Œå¦‚æœé€‰æ‹©ä¸åº”ç­”ï¼Œé‡Šæ”¾æ€»çº¿ã€‚\nä»€ä¹ˆæ˜¯é‡å¤èµ·å§‹æ¡ä»¶ï¼Ÿå®ƒæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ(1)    åœ¨ä¸ç»“æŸä¸€æ¬¡é€šè®¯çš„æƒ…å†µä¸‹ï¼Œå†æ¬¡å‘èµ·èµ·å§‹ä¿¡å·ï¼Œä½†æ˜¯è¿™ä¸ªé‡å¤èµ·å§‹ä¿¡å·çš„å‘èµ·å’Œèµ·å§‹ä¿¡å·ä¸å®Œå…¨ç›¸åŒï¼Œå› ä¸ºåœ¨ä¸»æœºå‘é€å®Œä¸€å¸§æ•°æ®ï¼Œä»æœºåº”ç­”åï¼ŒSDAå¤„äºä½ç”µå¹³çŠ¶æ€ï¼Œä¸»æœºå°†SCLä»é«˜ç”µå¹³æ‹‰åˆ°ä½ç”µå¹³ã€‚è¿™æ—¶ï¼Œéœ€è¦ç»•è¿‡ç»ˆæ­¢ä¿¡å·ï¼Œæ‰€ä»¥SCLéœ€è¦å…ˆè¢«æ‹‰ä½ï¼Œç„¶åæ‹‰é«˜SDAï¼Œä¹‹åå†æ‹‰é«˜SCLï¼ˆç»ˆäºç»•è¿‡ç»ˆæ­¢ä¿¡å·ï¼Œæ¢å¤åˆ°åˆå§‹çŠ¶æ€äº†ï¼Œä¸¤ä¸ªéƒ½ä¸ºé«˜ç”µå¹³ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™å†å‘èµ·å§‹ä¿¡å·ï¼Œå°±æ˜¯ä¸€æ¬¡å®Œæ•´çš„é‡å¤èµ·å§‹æ¡ä»¶äº†ã€‚\n(2)    å¯ä»¥è¿›è¡Œç”±å†™æŒ‡ä»¤åˆ°è¯»æŒ‡ä»¤çš„è½¬åŒ–ã€‚\nI2Cæ”¯æŒå“ªäº›é€Ÿç‡æ¨¡å¼ï¼Ÿå®é™…é€‰æ‹©æ—¶è€ƒè™‘å“ªäº›å› ç´ ï¼ŸI2Cçš„åœ°å€æœ‰å‡ ä½ï¼Ÿ7ä½åœ°å€çš„å¯ç”¨èŒƒå›´æ˜¯å¤šå°‘ï¼Ÿä»€ä¹ˆæ˜¯ä¿ç•™åœ°å€ï¼Ÿ(1)    7ä½æˆ–è€…10ä½\n(2)    ç†è®ºä¸Šæ˜¯0-127ï¼Œæ€»å…±æ˜¯128ä¸ªåœ°å€ã€‚\n(3)    æ˜¯ä¸€äº›ç‰¹æ®ŠåŠŸèƒ½çš„åœ°å€ï¼Œæ¯”å¦‚è¯´å¤ä½åŠŸèƒ½ï¼Œå¹¿æ’­åŠŸèƒ½ã€‚\nä¸ºä»€ä¹ˆI2Cè¦æ±‚ä½¿ç”¨å¼€æ¼è¾“å‡ºï¼Œè€Œä¸èƒ½ç”¨æ¨æŒ½è¾“å‡ºï¼Ÿ (éœ€ç†è§£æ€»çº¿å†²çªã€çŸ­è·¯é£é™©ã€å¤šä¸»æœºä»²è£)I2Cæ€»çº¿ä¸Šæœ€å¤šèƒ½è¿æ¥å¤šå°‘ä¸ªè®¾å¤‡ï¼Ÿå®é™…é™åˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ (æç¤ºï¼šåœ°å€ç©ºé—´é™åˆ¶ vs æ€»çº¿ç”µå®¹è´Ÿè½½é™åˆ¶)è§£é‡Šä»€ä¹ˆæ˜¯â€œæ—¶é’Ÿæ‹‰ä¼¸â€ã€‚å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿæœ‰ä»€ä¹ˆä½œç”¨ï¼ŸI2Cæ€»çº¿çš„æœ€å¤§ä¼ è¾“è·ç¦»å—å“ªäº›å› ç´ å½±å“ï¼Ÿå¦‚ä½•ä¼˜åŒ–ï¼ŸI2Cå¦‚ä½•å®ç°å¤šä¸»æœºé€šä¿¡ï¼Ÿè¯¦ç»†è§£é‡Šæ€»çº¿ä»²è£å’Œæ—¶é’ŸåŒæ­¥æœºåˆ¶ã€‚å¦‚æœæ€»çº¿ä¸Šæœ‰ä¸¤ä¸ªä»è®¾å¤‡åœ°å€ç›¸åŒï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿä¸»æœºå‘é€åœ°å€0x50å’Œä¸»æœºå‘é€åœ°å€0x52åŒæ—¶å‘èµ·é€šä¿¡ï¼Œè°å°†èµ¢å¾—ä»²è£ï¼Ÿè¯·æŒ‰ä½åˆ†æè¿‡ç¨‹ã€‚æ¯”è¾ƒI2Cä¸SPIåè®®çš„ä¼˜ç¼ºç‚¹ã€‚åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä¼˜å…ˆé€‰æ‹©I2Cï¼Ÿåˆ—ä¸¾I2Cé€šä¿¡ä¸­å¸¸è§çš„æ•…éšœåŠè§£å†³æ–¹æ³•ï¼ˆå¦‚æ€»çº¿æ­»é”ã€ACKä¸¢å¤±ã€æ—¶åºé—®é¢˜ç­‰ï¼‰ã€‚å¦‚æœå‘ç°I2Cé€šä¿¡ä¸ç¨³å®šï¼Œä½ çš„è°ƒè¯•æ­¥éª¤æ˜¯ä»€ä¹ˆï¼Ÿä¼šä½¿ç”¨ä»€ä¹ˆå·¥å…·ï¼Ÿ (å¦‚ç¤ºæ³¢å™¨ã€é€»è¾‘åˆ†æä»ª)æè¿°ä¸€æ¬¡ä½ è°ƒè¯•I2Cæ€»çº¿é—®é¢˜çš„å®é™…ç»å†ï¼ŒåŒ…æ‹¬é—®é¢˜ç°è±¡ã€åˆ†ææ€è·¯å’Œæœ€ç»ˆè§£å†³æ–¹æ¡ˆã€‚ (è¿™æ˜¯å±•ç°ä½ å·¥ç¨‹èƒ½åŠ›çš„ç»ä½³æœºä¼š)","categories":["Linux I2Cé©±åŠ¨"],"tags":["I2C"]},{"title":"CANé€šä¿¡è°ƒè¯•è®°å½•","url":"/2026/02/13/2026-2-13-can%E9%80%9A%E4%BF%A1%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/","content":"1. å¸§æ ¼å¼\næ ‡å‡†å¸§ï¼ˆ11ä½IDï¼‰\næ•°æ®é•¿åº¦ï¼šå›ºå®š1å­—èŠ‚ï¼ˆDLC &#x3D; 1ï¼‰\n\n2. IDåˆ†é…ï¼ˆä¸¤ä¸ªIDå°±å¤Ÿäº†ï¼‰\n\n\nCAN ID\nåŠŸèƒ½\næ•°æ®å­—èŠ‚å«ä¹‰\n\n\n\n0x100\næ²¹é—¨æ§åˆ¶\n0&#x3D;åœæ­¢ï¼›1100&#x3D;å‰è¿›é€Ÿåº¦ç™¾åˆ†æ¯”ï¼›101200&#x3D;åé€€é€Ÿåº¦ç™¾åˆ†æ¯”\n\n\n0x101\nè½¬å‘æ§åˆ¶\n0&#x3D;ç›´è¡Œï¼›1100&#x3D;å·¦è½¬è§’åº¦ç™¾åˆ†æ¯”ï¼›101200&#x3D;å³è½¬è§’åº¦ç™¾åˆ†æ¯”\n\n\nä¸€ä¸ªIDç®¡é€Ÿåº¦ï¼Œä¸€ä¸ªIDç®¡æ–¹å‘ï¼ŒSTM32æ”¶åˆ°åç›´æ¥æŸ¥è¡¨æ˜ å°„åˆ°PWMï¼Œæ— éœ€è§£æå‘½ä»¤ç \n3. æ•°æ®æ˜ å°„ç¤ºä¾‹æ²¹é—¨æ§åˆ¶ï¼ˆID&#x3D;0x100ï¼‰\n\n\nå‘é€å­—èŠ‚\nå®é™…åŠ¨ä½œ\n\n\n\n0\nç”µæœºåœæ­¢\n\n\n50\n50%é€Ÿåº¦å‰è¿›\n\n\n100\n100%é€Ÿåº¦å‰è¿›\n\n\n150\n50%é€Ÿåº¦åé€€\n\n\n200\n100%é€Ÿåº¦åé€€\n\n\nè½¬å‘æ§åˆ¶ï¼ˆID&#x3D;0x101ï¼‰\n\n\nå‘é€å­—èŠ‚\nå®é™…åŠ¨ä½œ\n\n\n\n0\nè½¦è½®å›æ­£\n\n\n50\nå·¦è½¬50%è§’åº¦\n\n\n100\nå·¦è½¬æœ€å¤§è§’åº¦\n\n\n150\nå³è½¬50%è§’åº¦\n\n\n200\nå³è½¬æœ€å¤§è§’åº¦\n\n\nRK3568æ§åˆ¶ç¤ºä¾‹# å‰è¿› 50% é€Ÿåº¦cansend can0 100#32   #å¯¹åº”10è¿›åˆ¶æ˜¯50# å‰è¿› 30% é€Ÿåº¦cansend can0 100#1E   # 0x1E = 30 è¿™æ˜¯å‰è¿›é€Ÿåº¦ï¼Œåé€€éœ€è¦100+30=130=0x82# æ­£ç¡®åé€€30%ï¼šcansend can0 100#82# å·¦è½¬50%cansend can0 101#32   # 0x32 = 50# å³è½¬80%cansend can0 101#B4   # 0xB4 = 180 \n\n\n\nCANå‘½ä»¤ç¤ºä¾‹CANå‘é€:    å‘é€ï¼ˆæ ‡å‡†å¸§,æ•°æ®å¸§,ID:123,date:DEADBEEFï¼‰:    cansend can0 123#DEADBEEF    å‘é€ï¼ˆæ ‡å‡†å¸§,è¿œç¨‹å¸§,ID:123ï¼‰:    cansend can0 123#R    å‘é€ï¼ˆæ‰©å±•å¸§,æ•°æ®å¸§,ID:00000123,date:DEADBEEFï¼‰:    cansend can0 00000123#12345678    å‘é€ï¼ˆæ‰©å±•å¸§,è¿œç¨‹å¸§,ID:00000123ï¼‰:    cansend can0 00000123#RCANæ¥æ”¶:    å¼€å¯æ‰“å°ï¼Œç­‰å¾…æ¥æ”¶:    candump can0\n\n\n\nå››ã€æ³¨æ„äº‹é¡¹ï¼ˆé¿å‘æŒ‡å—ï¼‰æ³¢ç‰¹ç‡å¿…é¡»ä¸€è‡´ï¼ˆ500kï¼‰Linuxç«¯å’ŒSTM32ç«¯éƒ½è¦è®¾ç½®æˆå®Œå…¨ç›¸åŒçš„æ³¢ç‰¹ç‡ï¼ˆ500kï¼‰ã€‚\nç»ˆç«¯ç”µé˜»ä¸€å®šè¦åŠ ä¸¤ä¸ª120Î©ç”µé˜»å¹¶è”åœ¨æ€»çº¿ä¸Š\nGNDè¿æ¥è‹¥STM32å’ŒRK3568ä½¿ç”¨ç‹¬ç«‹ç”µæºï¼Œå¿…é¡»å…±åœ°ï¼ˆæ¥GNDï¼‰ï¼Œå¦åˆ™æ— æ³•é€šä¿¡ã€‚\næ•°æ®è¶Šç•Œå¤„ç†STM32ä¾§æ”¶åˆ°&gt;200çš„æ•°å€¼æ—¶ï¼Œå»ºè®®ç›´æ¥å¿½ç•¥æˆ–æŒ‰200å¤„ç†ï¼Œé˜²æ­¢æ•°ç»„æº¢å‡ºã€‚\näº”ã€æ‰©å±•ï¼ˆæœªæ¥éœ€è¦æ›´å¤šåŠŸèƒ½ï¼‰æŒ‰æ­¤æç®€æ–¹æ¡ˆï¼Œæœªæ¥å¢åŠ åŠŸèƒ½åªéœ€æ–°å¢IDï¼Œä¾‹å¦‚ï¼š\n\n0x102ï¼šç¯å…‰æ§åˆ¶\n0x103ï¼šå–‡å­&#x2F;èœ‚é¸£å™¨\n0x104ï¼šå‚æ•°é…ç½®\n\næ¯ä¸ªIDå›ºå®š1å­—èŠ‚æ•°æ®ï¼ŒSTM32ç«¯åŠ ä¸€ä¸ªcaseå³å¯ï¼Œå®Œå…¨ä¸å½±å“åŸæœ‰æ§åˆ¶é€»è¾‘ã€‚\nå…­ã€Linux CANåº”ç”¨ç¼–ç¨‹å…³é”®æ•°æ®ç»“æ„sockaddr_canä¸“é—¨ç”¨æ¥æè¿°ä¸€ä¸ªcanè®¾å¤‡çš„åœ°å€åˆ›å»ºsocketæ¥å£åï¼Œéœ€è¦æŠŠå®ƒç»‘å®šåˆ°ç‰¹å®šçš„cané€šä¿¡è®¾å¤‡ä¸Šstruct sockaddr_can &#123;\t__kernel_sa_family_t can_family;\t\t// åè®®æ—ï¼Œå›ºå®šå¡« AF_CAN\tint         can_ifindex;\t\t\t\t// ç½‘ç»œæ¥å£ç´¢å¼•ï¼ˆå¦‚ can0 çš„ç¼–å·ï¼‰\tunion     &#123;\t\t// ç”¨äº ISO-TP (Transport Protocol) ç­‰åè®®\t\tstruct &#123; canid_t rx_id, tx_id; &#125; tp;\t\t// ç”¨äº SAE J1939 åè®®\t\tstruct         &#123;\t\t\t__u64 name;\t\t\t__u32 pgn;\t\t\t__u8 addr;\t\t&#125; j1939;\t\t// æœªæ¥å…¶ä»–åè®®...\t&#125; can_addr;&#125;;\n\ncan_frameæ¶ˆæ¯å¸§struct can_frame &#123;\tcanid_t can_id;  // 32ä½ï¼ŒåŒ…å« CAN ID + æ ‡å¿—ä½\tunion &#123;\t\t__u8 len;\t\t// æ•°æ®é•¿åº¦ (0-8)  â€”â€”â€”â€” ç°åœ¨æ­£å¼çš„åå­—\t\t__u8 can_dlc; \t// æ—§åå­—ï¼Œå…¼å®¹è€ä»£ç ï¼Œç”¨ len å°±è¡Œ\t&#125; __attribute__((packed)); /* disable padding added in some ABIs */\t\t__u8 data[CAN_MAX_DLEN] __attribute__((aligned(8)));// æœ€å¤š8å­—èŠ‚æ•°æ®\t\t....ä»¥ä¸Šå‡ ä¸ªæˆå‘˜æœ€é‡è¦ï¼Œå…¶ä»–å‡ ä¹æ°¸è¿œç”¨ä¸åˆ°&#125;;\n\nstruct ifreq ï¼ˆä¸æ‡‚ï¼‰struct ifreq &#123;    char ifr_name[IFNAMSIZ];      /* æ¥å£åç§°ï¼Œå¦‚ &quot;can0&quot;, &quot;eth0&quot; */    union &#123;        struct sockaddr ifru_addr;        struct sockaddr ifru_dstaddr;        struct sockaddr ifru_broadaddr;        struct sockaddr ifru_netmask;        struct sockaddr ifru_hwaddr;        short           ifru_flags;        int             ifru_ivalue;    /* è¿™é‡Œå­˜æ”¾ç´¢å¼•æˆ–æ•°å€¼ */        int             ifru_mtu;        struct ifmap    ifru_map;        char            ifru_slave[IFNAMSIZ];        char            ifru_newname[IFNAMSIZ];        caddr_t         ifru_data;    &#125; ifr_ifru;&#125;;\n\n\n\nsocketç”³è¯·sockfd = socket(PF_CAN, SOCK_RAW, CAN_RAW);/* PF_CAN æŒ‡å®šåè®®æ—ï¼ˆç±»ä¼¼IPV4çš„PF_INETï¼‰ï¼Œè¿™é‡ŒæŒ‡å®šCANåè®® *//* SOCK_RAW åŸå§‹å¥—æ¥å­—ï¼Œè¡¨ç¤ºç›´æ¥ä½¿ç”¨åŸå§‹å¸§ï¼ˆå¦‚æœæ˜¯IPV4ä½¿ç”¨SOCK_RAWï¼Œåˆ™è¡¨ç¤ºè‡ªå·±æ„é€ IPå¤´ï¼‰ *//* CAN_RAW åè®®ç±»å‹ï¼Œå¯ä»¥ç†è§£ä¸ºè£¸æ•°æ® */\n\næŒ‡å®š can0 è®¾å¤‡ï¼ˆç†è§£ä¸ºè®¾ç½®IPåœ°å€ï¼‰/* â€œcan0â€å°±ç›¸å½“äºIPV4ä¸­çš„ï¼Œ192.168.6.9 */strcpy(ifr.ifr_name, &quot;can0&quot;);\t\t\t// æŒ‡å®šIPioctl(sockfd, SIOCGIFINDEX, &amp;ifr);\t\t// è®¾ç½®IPcan_addr.can_family = AF_CAN;\t\t\t// æŒ‡å®šåè®®æ—can_addr.can_ifindex = ifr.ifr_ifindex;\t// å–å‡ºç´¢å¼•ï¼Œå¡«å……åœ°å€ç»“æ„ä½“\n\n\n\nbindç»‘å®šï¼ˆå°†sockfdå’Œcan_addråœ°å€ç»‘å®šèµ·æ¥ï¼‰ret = bind(sockfd, (struct sockaddr *)&amp;can_addr, sizeof(can_addr));\n\n\n\næ•°æ®å¸§æ„é€ unsigned char buffer[4] = &#123;0&#125;;memcpy(frame.data, buffer, sizeof(buffer));\t// å¾€æ•°æ®åŒºé‡Œéšä¾¿å†™ç‚¹æ•°æ®frame.can_dlc = sizeof(buffer);\t\t\t\t// æ•°æ®é•¿åº¦ = 4ï¼ˆDLC = 4ï¼‰frame.can_id = 0x123;\t\t\t\t\t\t// CAN ID = 0x123ï¼ˆæ ‡å‡†å¸§ï¼‰\n\nå‘é€æ•°æ®å¸§ret = write(sockfd, &amp;frame, sizeof(frame));\n\nä¾‹ç¨‹#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;string.h&gt;#include &lt;unistd.h&gt;#include &lt;sys/ioctl.h&gt;#include &lt;sys/socket.h&gt;#include &lt;linux/can.h&gt;#include &lt;linux/can/raw.h&gt;#include &lt;net/if.h&gt;#include &lt;stdint.h&gt;/* æˆåŠŸreturn sockfd */int can_dev_init(uint32_t boudrate)&#123;    struct ifreq ifr = &#123;0&#125;;    struct sockaddr_can can_addr = &#123;0&#125;;    int sockfd = -1;    int ret = -1;    char cmd[128];    // è®¾ç½®CANæ³¢ç‰¹ç‡ä¸ºboudrate = 500000    system(&quot;ip link set can0 down&quot;);    sprintf(cmd, &quot;ip link set can0 type can bitrate %d&quot;, boudrate);     system(cmd);    system(&quot;ip link set can0 up&quot;);    sockfd = socket(PF_CAN, SOCK_RAW, CAN_RAW);    if(0 &gt; sockfd)     &#123;        perror(&quot;CAN0 socket error&quot;);        ret = -1;        return ret;    &#125;    /* æŒ‡å®š can0 è®¾å¤‡ */    strcpy(ifr.ifr_name, &quot;can0&quot;);    ioctl(sockfd, SIOCGIFINDEX, &amp;ifr);    can_addr.can_family = AF_CAN;    can_addr.can_ifindex = ifr.ifr_ifindex;    /* å°† can0 ä¸å¥—æ¥å­—è¿›è¡Œç»‘å®š */    ret = bind(sockfd, (struct sockaddr *)&amp;can_addr, sizeof(can_addr));    if ( 0 &gt; ret )     &#123;        perror(&quot;CAN0 bind error&quot;);        close(sockfd);        return -1;    &#125;    return sockfd;&#125;void can_dev_exit(int sockfd)&#123;    close(sockfd);&#125;/* æˆåŠŸè¿”å›0 */int can_send_raw_frame(int sockfd, canid_t frame_id, uint8_t* frame_data, uint8_t data_len)&#123;    struct can_frame frame = &#123;0&#125;;    int ret = -1;    if( data_len &gt; 8)    &#123;        fprintf(stderr, &quot;é”™è¯¯ï¼šæ•°æ®é•¿åº¦ %d è¶…è¿‡ CAN å¸§æœ€å¤§ 8 å­—èŠ‚\\n&quot;, data_len);        return -1;    &#125;    memcpy(frame.data, frame_data, data_len);    frame.can_dlc   = data_len;     // æ•°æ®é•¿åº¦ï¼Œå•ä½å­—èŠ‚    frame.can_id    = frame_id;    ret = write(sockfd, &amp;frame, sizeof(frame));    if (sizeof(frame) != ret)     &#123;        perror(&quot;can_send_raw_frame error&quot;);        return -1;    &#125;    return 0;&#125;// å‡½æ•°å£°æ˜int can_dev_init(uint32_t boudrate);void can_dev_exit(int sockfd);int can_send_raw_frame(int sockfd, canid_t frame_id, uint8_t* frame_data, uint8_t data_len);int main(int argc, char *argv[])&#123;    // 1. åˆå§‹åŒ– CAN è®¾å¤‡ï¼Œæ³¢ç‰¹ç‡ 500kbps    int sockfd = can_dev_init(500000);    if (sockfd &lt; 0)     &#123;        fprintf(stderr, &quot;CAN device init failed\\n&quot;);        exit(EXIT_FAILURE);    &#125;    printf(&quot;CAN device initialized, sockfd = %d\\n&quot;, sockfd);    printf(&quot;Start sending test frames...\\n&quot;);    // 2. å‡†å¤‡æµ‹è¯•æ•°æ®    uint8_t throttle_data[1];   // æ²¹é—¨å€¼    uint8_t steer_data[1];      // è½¬å‘å€¼    int count = 0;    // 3. å¾ªç¯å‘é€ CAN å¸§ï¼ˆæŒ‰ Ctrl+C ç»ˆæ­¢ï¼‰    while (1)     &#123;        // --- æ²¹é—¨æ§åˆ¶ï¼šID=0x100ï¼Œæ•°æ® 0~100 å¾ªç¯ ---        throttle_data[0] = count % 101;   // 0~100 å‰è¿›é€Ÿåº¦ç™¾åˆ†æ¯”        if (can_send_raw_frame(sockfd, 0x100, throttle_data, 1) == 0)         &#123;            printf(&quot;[send] throttle: %d%% forward\\n&quot;, throttle_data[0]);        &#125;         else         &#123;            fprintf(stderr, &quot;[error] send throttle failed\\n&quot;);        &#125;        // --- è½¬å‘æ§åˆ¶ï¼šID=0x101ï¼Œå·¦è½¬/å³è½¬äº¤æ›¿ ---        int steer_val;        if ((count / 50) % 2 == 0)         &#123;            steer_val = count % 51;        // 0~50  å·¦è½¬è§’åº¦            printf(&quot;[send] steer: left %d%%\\n&quot;, steer_val);        &#125;         else         &#123;            steer_val = 100 + (count % 51); // 100~150 å³è½¬è§’åº¦ï¼ˆå³è½¬æ—¶æ•°å€¼=100+è§’åº¦ï¼‰            printf(&quot;[send] steer: right %d%%\\n&quot;, steer_val - 100);        &#125;        steer_data[0] = (uint8_t)steer_val;        if (can_send_raw_frame(sockfd, 0x101, steer_data, 1) != 0)         &#123;            fprintf(stderr, &quot;[error] send steer failed\\n&quot;);        &#125;        count++;        usleep(500000);   // 500ms å‘é€ä¸€æ¬¡    &#125;    // 4. å…³é—­ CAN è®¾å¤‡ï¼ˆå®é™…ä¸ä¼šæ‰§è¡Œåˆ°è¿™é‡Œï¼‰    can_dev_exit(sockfd);    exit(EXIT_SUCCESS);&#125;\n\n\n\n\n\n\n\nä¸ƒã€è¡¥å……Linuxåº”ç”¨ç¼–ç¨‹çŸ¥è¯†ä¸ºä»€ä¹ˆè¦ç”¨ perrorï¼Ÿç³»ç»Ÿè°ƒç”¨ï¼ˆå¦‚ socketã€bindã€ioctlï¼‰å¤±è´¥æ—¶ï¼Œå†…æ ¸ä¼šè®¾ç½®ä¸€ä¸ªå…¨å±€é”™è¯¯ç  errnoï¼ˆä¾‹å¦‚ 13 &#x3D; EACCESï¼‰ã€‚perror ä¼šè‡ªåŠ¨è¯»å–å½“å‰çš„ errnoï¼ŒæŠŠå®ƒç¿»è¯‘æˆäººç±»å¯è¯»çš„å­—ç¬¦ä¸²å¹¶æ‰“å°ã€‚\nä¸ç”¨ perror çš„è¯ï¼š\nif (sockfd &lt; 0) &#123;    printf(&quot;socket error\\n&quot;);   // ä½ ä¸çŸ¥é“å…·ä½“ä¸ºä»€ä¹ˆé”™&#125;\n\nç”¨äº† perrorï¼š\nif (sockfd &lt; 0) &#123;    perror(&quot;socket error&quot;);     // è¾“å‡ºï¼šsocket error: Permission denied&#125;\n\n\n\nè‡ªå®šä¹‰å‡½æ•°åæ ¸å¿ƒåŸåˆ™\nå…¨å±€ç¬¦å·åŠ å‰ç¼€ï¼ˆé¿å…é“¾æ¥å†²çªï¼‰\næ ¼å¼ï¼šæ¨¡å—å_åŠ¨ä½œ_å¯¹è±¡\nä¾‹å¦‚ï¼šcan_init, uart_send_byte, gpio_set_level\n\n\nåŠ¨è¯å¼€å¤´ + å®¾è¯­ï¼ˆä¸€çœ¼çœ‹å‡ºåŠŸèƒ½ï¼‰\nä¾‹å¦‚ï¼šget_temperature, set_motor_speed, enable_interrupt\n\n\nç»Ÿä¸€é£æ ¼ï¼Œå…¨å°å†™ + ä¸‹åˆ’çº¿ï¼ˆsnake_caseï¼‰\nC æ ‡å‡†åº“ã€Linux å†…æ ¸éƒ½æ˜¯è¿™ç§é£æ ¼ï¼Œæœ€ç¬¦åˆ C è¯­è¨€ä¼ ç»Ÿã€‚\n\n\nç§æœ‰&#x2F;é™æ€å‡½æ•°å¯åŠ ä¸‹åˆ’çº¿å‰ç¼€\nä¾‹å¦‚ï¼š_can_write_reg, _calc_crc16\n\n\n\n","categories":["Linux CANåº”ç”¨å¼€å‘"],"tags":["CAN"]},{"title":"USBé”®ç›˜é©±åŠ¨ç¨‹åºè°ƒè¯•è®°å½•","url":"/2026/02/15/2026-2-15-usb%E9%94%AE%E7%9B%98%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/","content":"pé”®ç›˜æ’å…¥Linuxæ¿å¡çš„æ—¶å€™ï¼Œç¬¬ä¸€ä¸ªå’Œä»–é€šä¿¡çš„é©±åŠ¨ç¨‹åºæ˜¯è°\næŠ›å‡ºç›˜æ’å…¥Linuxæ¿å¡çš„æ—¶å€™ï¼Œç¬¬ä¸€ä¸ªå’Œä»–é€šä¿¡çš„é©±åŠ¨ç¨‹åºæ˜¯è°\nç¬¬ä¸€æ­¥æŠ›å‡ºé—®é¢˜ï¼šæ’å…¥Linuxæ¿å¡çš„æ—¶å€™ï¼Œç¬¬ä¸€ä¸ªå’Œä»–é€šä¿¡çš„é©±åŠ¨ç¨‹åºæ˜¯è°\nç­”æ¡ˆï¼šä¸»æœºæ§åˆ¶å™¨é©±åŠ¨ï¼ˆä¾‹å¦‚ ehci-hcdã€xhci-hcdï¼‰èŒè´£\nå¤ä½è®¾å¤‡ï¼šå‘æ–°æ’å…¥çš„è®¾å¤‡å‘é€å¤ä½ä¿¡å·ã€‚\nåˆ†é…åœ°å€ï¼šé€šè¿‡æ§åˆ¶ä¼ è¾“ä¸ºè®¾å¤‡åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„ USB åœ°å€ï¼ˆé€šå¸¸æ˜¯åœ°å€ 1ï¼Œç„¶åé‡æ–°åˆ†é…ï¼‰ã€‚\nè·å–è®¾å¤‡æè¿°ç¬¦ï¼šè¯»å–è®¾å¤‡çš„åŸºæœ¬ä¿¡æ¯ï¼ˆå¦‚å‚å•† IDã€äº§å“ IDã€è®¾å¤‡ç±»ç­‰ï¼‰ã€‚\nè¿™äº›æ“ä½œéƒ½æ˜¯åœ¨ä¸»æœºæ§åˆ¶å™¨é©±åŠ¨çš„æ§åˆ¶ä¸‹ï¼Œé€šè¿‡ USB æ€»çº¿å‘é€æ•°æ®åŒ…å®Œæˆçš„ã€‚\n\nç¬¬äºŒæ­¥ï¼šUSB æ ¸å¿ƒï¼ˆUSB Coreï¼‰çš„ä»‹å…¥\nä¸»æœºæ§åˆ¶å™¨é©±åŠ¨å°†è·å–åˆ°çš„ä¿¡æ¯ä¸ŠæŠ¥ç»™ USB æ ¸å¿ƒï¼ˆUSB Coreï¼Œå³å†…æ ¸ä¸­çš„ usbcore æ¨¡å—ï¼‰ã€‚\nUSB æ ¸å¿ƒç»´æŠ¤ç€æ‰€æœ‰å·²æ³¨å†Œçš„ USB è®¾å¤‡é©±åŠ¨ï¼ˆå¦‚ usbhidã€usbkbdï¼‰ä»¥åŠå®ƒä»¬çš„ usb_device_id è¡¨ã€‚\nUSB æ ¸å¿ƒå¼€å§‹æšä¸¾è¿‡ç¨‹ï¼šè¯»å–è®¾å¤‡çš„é…ç½®ã€æ¥å£ã€ç«¯ç‚¹ç­‰ä¿¡æ¯ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª usb_interface ä»£è¡¨é”®ç›˜çš„æ¥å£ã€‚\n\nç¬¬ä¸‰æ­¥ï¼šåŒ¹é…å…·ä½“çš„è®¾å¤‡é©±åŠ¨\nUSB æ ¸å¿ƒéå†æ‰€æœ‰å·²æ³¨å†Œçš„ USB è®¾å¤‡é©±åŠ¨çš„ id_tableï¼Œå¯»æ‰¾ä¸å½“å‰è®¾å¤‡åŒ¹é…çš„æ¡ç›®ã€‚\n\nå¯¹äºæ ‡å‡† USB é”®ç›˜ï¼Œé€šå¸¸åŒ¹é…çš„æ˜¯ HID ç±»é©±åŠ¨ï¼ˆå¦‚ usbhid æˆ–ä½ ä¹‹å‰çœ‹åˆ°çš„ usbkbdï¼‰ã€‚\n\nä¸€æ—¦æ‰¾åˆ°åŒ¹é…ï¼ŒUSB æ ¸å¿ƒè°ƒç”¨è¯¥é©±åŠ¨çš„ probe å‡½æ•°ï¼Œå¹¶å°† usb_interface äº¤ç»™å®ƒã€‚\n\nè®¾å¤‡é©±åŠ¨ï¼ˆå¦‚ usbkbdï¼‰åœ¨ probe ä¸­åˆå§‹åŒ–è®¾å¤‡ï¼Œæ³¨å†Œè¾“å…¥è®¾å¤‡ï¼Œå¹¶æäº¤ URB å¼€å§‹æ¥æ”¶é”®ç›˜æ•°æ®ã€‚\n\nè‡³æ­¤ï¼Œé”®ç›˜æ‰çœŸæ­£å¯ä»¥è¢«ç”¨æˆ·ç©ºé—´ä½¿ç”¨ã€‚\n\n\næ€»ç»“\nç¬¬ä¸€ä¸ªä¸ç¡¬ä»¶é€šä¿¡çš„æ˜¯ä¸»æœºæ§åˆ¶å™¨é©±åŠ¨ï¼Œå®ƒè´Ÿè´£æœ€åº•å±‚çš„ç¡¬ä»¶äº¤äº’å’Œåˆå§‹åŒ–ã€‚\nç¬¬äºŒä¸ªå‚ä¸çš„æ˜¯ USB æ ¸å¿ƒï¼Œå®ƒè´Ÿè´£ç®¡ç†æšä¸¾å’Œé©±åŠ¨åŒ¹é…ã€‚\næœ€ç»ˆå…·ä½“åŠŸèƒ½ç”±ä¸“é—¨çš„ USB è®¾å¤‡é©±åŠ¨ï¼ˆå¦‚ HID é©±åŠ¨ï¼‰å®ç°ã€‚\n\nHID é©±åŠ¨æ˜¯ä»€ä¹ˆï¼Ÿ\né€šç”¨äººç±»è¾“å…¥è®¾å¤‡é©±åŠ¨ï¼Œå½“ç„¶å¯ä»¥ç»™é”®ç›˜ç”¨\nå½“HIDé©±åŠ¨ç¨‹åºä¸å­˜åœ¨çš„æ—¶å€™ï¼Œæ’å…¥USBé”®ç›˜ï¼Œæ—¥å¿—æ‰“å°å¦‚ä¸‹\n[   26.313520] usb 5-1: new low-speed USB device number 2 using xhci-hcd[   26.460776] usb 5-1: New USB device found, idVendor=413c, idProduct=2107, bcdDevice= 1.15[   26.460796] usb 5-1: New USB device strings: Mfr=1, Product=2, SerialNumber=0[   26.460807] usb 5-1: Product: Dell USB Entry Keyboard[   26.460817] usb 5-1: Manufacturer: Dell\n\n\n\næ’å…¥USBæ‰‹æŸ„ï¼Œæ—¥å¿—æ‰“å°\n[  112.056887] usb 3-1: new full-speed USB device number 2 using ohci-platform[  112.290586] usb 3-1: New USB device found, idVendor=3537, idProduct=2106, bcdDevice= 1.00[  112.290598] usb 3-1: New USB device strings: Mfr=1, Product=2, SerialNumber=0[  112.290602] usb 3-1: Product: HID zk[  112.290607] usb 3-1: Manufacturer: Zikway\n\n\n\n\n\n\n\n\n\nå’ŒUSBé”®ç›˜é€šè®¯éœ€è¦äº†è§£çš„çŸ¥è¯†\n\nUSBé”®ç›˜é€šè®¯åè®®\n\nUSBåŒ¹é…å…³é”®æ­¥éª¤ï¼šUSB æ ¸å¿ƒåœ¨è¿›è¡Œæ¥å£åŒ¹é…æ—¶ï¼Œä¼šæ£€æŸ¥è®¾å¤‡ä¸­å½“å‰æ¥å£ï¼ˆå³ probe å‡½æ•°ä¼ å…¥çš„ struct usb_interface *ifaceï¼‰çš„æè¿°ç¬¦æ˜¯å¦åŒ¹é…è¿™äº›å­—æ®µã€‚\nUSBè®¾å¤‡é©±åŠ¨ç›¸å…³çš„æ•°æ®ç»“æ„ï¼š\nstruct usb_device_id &#123;\t/* which fields to match against? */\t__u16\t\tmatch_flags;\t//ä½æ©ç ï¼ŒæŒ‡å®šå“ªäº›å­—æ®µéœ€è¦å‚ä¸åŒ¹é…\t/* Used for product specific matches; range is inclusive */\t__u16\t\tidVendor;\t\t//USB è®¾å¤‡çš„å‚å•† IDï¼ˆVendor IDï¼‰\t__u16\t\tidProduct;\t\t//äº§å“ IDï¼ˆProduct IDï¼‰\t__u16\t\tbcdDevice_lo;\t// è®¾å¤‡ç‰ˆæœ¬å·ä¸Šé™\t__u16\t\tbcdDevice_hi;\t// è®¾å¤‡ç‰ˆæœ¬å·ä¸‹é™\t/* åŒ¹é…è®¾å¤‡æè¿°ç¬¦ä¸­çš„ç±»ã€å­ç±»å’Œåè®® */\t__u8\t\tbDeviceClass;\t\t// åŸºæœ¬è®¾è®¾å¤‡ç±»ï¼Œå¦‚é€šä¿¡è®¾å¤‡ç±»ï¼ˆCDCï¼‰,HIDè®¾å¤‡,é›†çº¿å™¨\t__u8\t\tbDeviceSubClass;\t// å­ç±»ï¼Œä¸€èˆ¬éƒ½æ˜¯USB_INTERFACE_SUBCLASS_BOOT\t__u8\t\tbDeviceProtocol;\t// åè®®ï¼Œå®šä¹‰å…·ä½“ä¼ è¾“åè®®ï¼Œå¦‚é¼ æ ‡ï¼Œé”®ç›˜ï¼Œæ‰‹æŸ„\t/* åŒ¹é…æ¥å£æè¿°ç¬¦ä¸­çš„ç±»ã€å­ç±»å’Œåè®® */\t__u8\t\tbInterfaceClass;\t// å’Œè®¾å¤‡æè¿°ç¬¦ä¸­çš„ä¸€æ ·ï¼Ÿ\t__u8\t\tbInterfaceSubClass;\t__u8\t\tbInterfaceProtocol;\t/* Used for vendor-specific interface matches */\t__u8\t\tbInterfaceNumber;\t// æŒ‡å®šè¦åŒ¹é…çš„æ¥å£ç¼–å·ï¼ˆç”¨ä¸åˆ°ï¼‰        ......&#125;;é‡è¦å®å®šä¹‰#define USB_INTERFACE_INFO(cl, sc, pr) \\\t.match_flags = USB_DEVICE_ID_MATCH_INT_INFO, \\\t.bInterfaceClass = (cl), \\\t.bInterfaceSubClass = (sc), \\\t.bInterfaceProtocol = (pr)\n\n\n\nstruct usb_interface &#123;\tstruct usb_host_interface *altsetting;\t/* æŒ‡å‘ä¸€ä¸ªç”± struct usb_host_interface ç»„æˆçš„æ•°ç»„ */\t    struct usb_host_interface *cur_altsetting;\t/* æŒ‡å‘å½“å‰æ­£åœ¨ä½¿ç”¨çš„é‚£ä¸ªå¤‡ç”¨è®¾ç½®ã€‚é©±åŠ¨ç¨‹åºé€šå¸¸ä½¿ç”¨è¿™ä¸ªæŒ‡é’ˆæ¥è®¿é—®å½“å‰æœ‰æ•ˆçš„æ¥å£æè¿°ç¬¦å’Œç«¯ç‚¹ä¿¡æ¯ã€‚ */\t\tunsigned num_altsetting;\t/* è®°å½• altsetting æ•°ç»„ä¸­å¤‡ç”¨è®¾ç½®çš„ä¸ªæ•° */\tstruct device dev;\t\t/* å†…æ ¸è®¾å¤‡æ¨¡å‹çš„æ ¸å¿ƒç»“æ„ï¼Œå°†æ¥å£è¡¨ç¤ºä¸ºè®¾å¤‡æ¨¡å‹ä¸­çš„ä¸€ä¸ªè®¾å¤‡ã€‚è¿™ä½¿å¾—æ¥å£å¯ä»¥åœ¨ sysfs ä¸­å‡ºç°ï¼ˆå¦‚ /sys/bus/usb/devices/...ï¼‰ */\t    ......&#125;;\n\n\n\nstruct usb_device &#123;\tint\t\tdevnum;\t\t/* æšä¸¾è¿‡ç¨‹ä¸­ç”± USB æ ¸å¿ƒåˆ†é…ç»™è®¾å¤‡çš„å”¯ä¸€åœ°å€ï¼ˆ1ï½127ï¼‰ */ \tchar\t\tdevpath[16];\t/* è®¾å¤‡è·¯å¾„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ &quot;1-2.3&quot;ï¼Œè¡¨ç¤ºè®¾å¤‡åœ¨ USB æ‹“æ‰‘ä¸­çš„ä½ç½®ï¼ˆæ€»çº¿å·-ç«¯å£å·.å­ç«¯å£å·...ï¼‰ */\tu32\t\troute;\tenum usb_device_state\tstate;\tenum usb_device_speed\tspeed;\tunsigned int\t\trx_lanes;\tunsigned int\t\ttx_lanes;\tstruct usb_tt\t*tt;\tint\t\tttport;\tunsigned int toggle[2];\tstruct usb_device *parent;\tstruct usb_bus *bus;\tstruct usb_host_endpoint ep0;\tstruct device dev;\tstruct usb_device_descriptor descriptor;\tstruct usb_host_bos *bos;\tstruct usb_host_config *config;\tstruct usb_host_config *actconfig;\tstruct usb_host_endpoint *ep_in[16];\tstruct usb_host_endpoint *ep_out[16];\tchar **rawdescriptors;\tunsigned short bus_mA;\tu8 portnum;\tu8 level;\tunsigned can_submit:1;\tunsigned persist_enabled:1;\tunsigned have_langid:1;\tunsigned authorized:1;\tunsigned authenticated:1;\tunsigned wusb:1;\tunsigned lpm_capable:1;\tunsigned usb2_hw_lpm_capable:1;\tunsigned usb2_hw_lpm_besl_capable:1;\tunsigned usb2_hw_lpm_enabled:1;\tunsigned usb2_hw_lpm_allowed:1;\tunsigned usb3_lpm_u1_enabled:1;\tunsigned usb3_lpm_u2_enabled:1;\tint string_langid;\t/* static strings from the device */\tchar *product;\tchar *manufacturer;\tchar *serial;\tstruct list_head filelist;\tint maxchild;\tu32 quirks;\tatomic_t urbnum;\tunsigned long active_duration;#ifdef CONFIG_PM\tunsigned long connect_time;\tunsigned do_remote_wakeup:1;\tunsigned reset_resume:1;\tunsigned port_is_suspended:1;#endif\tstruct wusb_dev *wusb_dev;\tint slot_id;\tenum usb_device_removable removable;\tstruct usb2_lpm_parameters l1_params;\tstruct usb3_lpm_parameters u1_params;\tstruct usb3_lpm_parameters u2_params;\tunsigned lpm_disable_count;\tu16 hub_delay;\tANDROID_KABI_RESERVE(1);\tANDROID_KABI_RESERVE(2);\tANDROID_KABI_RESERVE(3);\tANDROID_KABI_RESERVE(4);&#125;;\n\n\n\nstruct usb_host_interface &#123;\tstruct usb_interface_descriptor\tdesc;\t//æ ‡å‡†çš„ USB æ¥å£æè¿°ç¬¦\tstruct usb_host_endpoint *endpoint;\t//ç«¯ç‚¹æ•°ç»„\t    ......&#125;;\n\n\n\n\n\nstruct usb_host_endpoint &#123;\tstruct usb_endpoint_descriptor\t\tdesc;\tstruct usb_ss_ep_comp_descriptor\tss_ep_comp;\tstruct usb_ssp_isoc_ep_comp_descriptor\tssp_isoc_ep_comp;\tstruct list_head\t\turb_list;\tvoid\t\t\t\t*hcpriv;\tstruct ep_device\t\t*ep_dev;\t/* For sysfs info */\tunsigned char *extra;   /* Extra descriptors */\tint extralen;\tint enabled;\tint streams;&#125;;\n\n","categories":["Linux USBé©±åŠ¨"],"tags":["USB"]},{"url":"/2026/02/16/2026-2-16-SGP30%E4%BC%98%E5%8C%96%E8%AE%B0%E5%BD%95/","content":"SGP30ä¼˜åŒ–ï¼š\nä½¿ç”¨æ ‡å‡† Linux é”™è¯¯ç ï¼ˆå¦‚ -EREMOTEIOã€-EFAULTã€-EINVALï¼‰ä»£æ›¿ -1ã€‚\n\næ—¥å¿—çº§åˆ«è°ƒæ•´,ä½¿ç”¨ KERN_EMERG è¿‡äºå¤¸å¼ ï¼Œåº”æ›¿æ¢ä¸º KERN_ERRã€KERN_INFO æˆ– dev_err&#x2F;dev_infoã€‚\n\nå¹¶å‘è®¿é—®ä¿æŠ¤,å¤šä¸ªè¿›ç¨‹åŒæ—¶è°ƒç”¨ read å¯èƒ½å¯¼è‡´ I2C æ€»çº¿ç«äº‰ã€‚\n\nä¿®å¤ç¼“å†²åŒºæº¢å‡ºé£é™©read å‡½æ•°ä¸­å›ºå®š sgp30_result[6]ï¼Œä½†ç”¨æˆ·ä¼ å…¥çš„ cnt å¯èƒ½å¤§äº 6ï¼Œå¯¼è‡´ copy_to_user è¶Šç•Œã€‚\n\nå¢åŠ ç”µæºç®¡ç†æ”¯æŒï¼Œå®ç° suspend &#x2F; resume å›è°ƒï¼Œåœ¨ç³»ç»ŸæŒ‚èµ·æ—¶å…³é—­ä¼ æ„Ÿå™¨ä»¥èŠ‚çœåŠŸè€—ã€‚\n\næ·»åŠ  sysfs æ¥å£ï¼Œé™¤å­—ç¬¦è®¾å¤‡å¤–ï¼Œæä¾› sysfs å±æ€§æ–‡ä»¶ï¼ˆå¦‚ co2ã€tvocï¼‰ï¼Œæ–¹ä¾¿ç”¨æˆ·ç©ºé—´ç›´æ¥è¯»å–æ•°æ®ã€‚\n\n\né—®é¢˜1ï¼šI2C ä¼ è¾“ï¼ˆå¦‚ i2c_transferï¼‰å¯èƒ½å¼•èµ·è¿›ç¨‹è°ƒåº¦ï¼ˆç­‰å¾…ç¡¬ä»¶å“åº”ã€ä¸­æ–­å¤„ç†ç­‰ï¼‰ï¼Œèƒ½ä½¿ç”¨å“ªäº›äº’æ–¥æ–¹æ¡ˆï¼Ÿå¯ä»¥ç”¨äº’æ–¥é”ã€ä¿¡å·é‡ï¼Œä¸èƒ½ç”¨è‡ªæ—‹é”\näº’æ–¥é”çš„è®¾è®¡ï¼šä¸ä¼šå…³ä¸­æ–­ï¼Œä¼šè®©å°è¯•è·å¾—é”çš„åº”ç”¨ç¨‹åºé™·å…¥ä¼‘çœ çŠ¶æ€ï¼ˆæ”¾å…¥ç­‰å¾…é˜Ÿåˆ—ï¼‰ã€‚å½“é”è¢«é‡Šæ”¾åï¼Œä¼šå”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„è¿›ç¨‹\nè‡ªæ—‹é”çš„è®¾è®¡ï¼šå¯èƒ½ä¼šå…³ä¸­æ–­ï¼ˆä¸å…è®¸è¿›ç¨‹ä¼‘çœ ï¼‰ï¼Œç”¨äºä¿æŠ¤éå¸¸çŸ­çš„ä¸´ç•ŒåŒº\né—®é¢˜2ï¼šä¸¤ä¸ªè¿›ç¨‹åŒæ—¶ä½¿ç”¨è¿™ä¸ªé©±åŠ¨ç¨‹åºçš„readå‡½æ•°ï¼Œå†…å­˜ç©ºé—´æ˜¯ä¸€æ ·çš„å—ï¼Ÿ\nFBbuffer-SPI-ST7789ä¼˜åŒ–:1. ç§»é™¤å†—ä½™çš„å­—ç¬¦è®¾å¤‡2.1 ä½¿ç”¨è¿è´¯ DMA ç¼“å†²åŒºå½“å‰ç”¨ kzalloc + virt_to_phys åˆ†é…æ˜¾å­˜ï¼Œå­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š\nkzalloc ä¸ä¿è¯ç‰©ç†è¿ç»­ï¼Œå¯¹äºå¤§å—å†…å­˜å¯èƒ½å¤±è´¥\n2.2 åˆ·å±çº¿ç¨‹ç¼“å†²åŒºå¤ç”¨display_fb_in_thread æ¯æ¬¡å¾ªç¯éƒ½ kzalloc&#x2F;kfree ä¸´æ—¶ç¼“å†²åŒºï¼ˆçº¦ 115KBï¼‰ï¼Œé¢‘ç¹åˆ†é…é‡Šæ”¾é™ä½æ€§èƒ½ä¸”å¯èƒ½å¤±è´¥ã€‚ä¼˜åŒ–æ–¹æ³•ï¼š\n3. åˆ·å±çº¿ç¨‹è°ƒåº¦ä¼˜åŒ–å½“å‰çº¿ç¨‹æ— ä¼‘çœ å¾ªç¯ï¼Œä¼š 100% å ç”¨ CPUã€‚åº”æ·»åŠ é€‚å½“å»¶æ—¶ï¼š\n5. SPI ä¼ è¾“ä¼˜åŒ–5.1 é¿å…é¢‘ç¹åˆ†é… spi_transfer5.2 æ‰¹é‡å‘é€æ•°æ®LCD_SetAddress ä¸­å¤šæ¬¡è°ƒç”¨ st7789_send_one_byteï¼Œå¯åˆå¹¶ä¸ºä¸€æ¬¡ SPI ä¼ è¾“ï¼Œå‡å°‘ GPIO ç¿»è½¬ï¼š\n6. GPIO é”™è¯¯å¤„ç†ä¸è®¾å¤‡æ ‘è§£æ6.2 è®¾ç½®é»˜è®¤å€¼if (of_property_read_u32(node, &quot;width&quot;, &amp;g_TFTdev.lcd_width))    g_TFTdev.lcd_width = 240;  // é»˜è®¤å€¼if (of_property_read_u32(node, &quot;height&quot;, &amp;g_TFTdev.lcd_height))    g_TFTdev.lcd_height = 240;\n\n7. é”™è¯¯è·¯å¾„èµ„æºé‡Šæ”¾probe ä¸­è‹¥æŸæ­¥å¤±è´¥ï¼Œéœ€ç¡®ä¿å·²åˆ†é…çš„èµ„æºè¢«é‡Šæ”¾ã€‚ä½¿ç”¨ devm_ ç³»åˆ—å‡½æ•°å¯è‡ªåŠ¨ç®¡ç†ï¼Œä½†å½“å‰æ··åˆäº†æ‰‹åŠ¨å’Œ devmã€‚å»ºè®®ç»Ÿä¸€ä½¿ç”¨ devm_ï¼ˆå¦‚ devm_gpio_request_oneã€devm_kzallocï¼‰ä»¥ç®€åŒ–é”™è¯¯å¤„ç†ã€‚\n10. å…¶ä»–\nç§»é™¤æœªä½¿ç”¨çš„å…¨å±€å˜é‡ g_pseudo_palette è‹¥ä¸éœ€è¦æ§åˆ¶å°æ”¯æŒï¼Œå¯åˆ é™¤ fb_setcolreg åŠå…³è”ä»£ç ã€‚\næ£€æŸ¥ spi_write_child_OfThis ä¸­ bits_per_word = 16 æ˜¯å¦ä¸ SPI æ§åˆ¶å™¨é…ç½®ä¸€è‡´ï¼ˆé€šå¸¸ SPI é»˜è®¤ 8 ä½ï¼Œè®¾ç½® 16 ä½éœ€è¦ç¡®ä¿æ”¯æŒï¼Œå¦åˆ™ä¼šå¯¼è‡´ä¼ è¾“é”™è¯¯ï¼‰ã€‚è‹¥æ§åˆ¶å™¨åªæ”¯æŒ 8 ä½ï¼Œå¯æ”¹ç”¨ 8 ä½æ¨¡å¼å‘é€ï¼Œä½†éœ€æ³¨æ„å­—èŠ‚åºã€‚\n\n"},{"url":"/2026/02/19/2026-2-19-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AA%81%E7%A0%B4512%E5%AD%97%E8%8A%82/","content":"ç¬¬å››è¯¾ï¼šä¸»å¼•å¯¼ç¨‹åºçš„æ‰©å±•ï¼ˆä¸Šï¼‰é—®é¢˜1ï¼šä¸»å¼•å¯¼ç¨‹åºä¸èƒ½è¶…è¿‡512å­—èŠ‚\nçªç ´æ–¹æ³•ï¼šåœ¨ä¸»å¼•å¯¼ç¨‹åºä¸­ï¼ŒåŠ è½½æ›´å¤§çš„ç¨‹åºåˆ°æŸä¸€ä¸ªåœ°å€ï¼Œåœ¨ä¸»å¼•å¯¼ç¨‹åºç»“æŸä¹‹å‰è·³è½¬è¿‡å»\nå…·ä½“è¦æ€ä¹ˆåšå‘¢ï¼Ÿ\n1. é¦–å…ˆå¿…é¡»è¦å¼•å…¥æ–‡ä»¶ç³»ç»Ÿï¼Œåªæœ‰é€šè¿‡æ–‡ä»¶ç³»ç»Ÿï¼Œæ‰èƒ½é€šè¿‡æ–‡ä»¶åæ‰¾åˆ°æ–‡ä»¶ï¼Œä»¥åŠçŸ¥é“ç›®æ ‡æ–‡ä»¶çš„å¤§å°\n2. å°†åˆ›å»ºå¥½çš„è½¯ç›˜æ ¼å¼åŒ–æˆFAT12æ–‡ä»¶ç³»ç»Ÿæ ¼å¼\n3. å°†æ ¼å¼åŒ–åçš„è½¯ç›˜æŒ‚è½½åˆ°Linuxæ–‡ä»¶ç³»ç»Ÿä¸‹ï¼ŒæŠŠç¼–è¯‘å¥½çš„loader.binç¨‹åºæ”¾è¿›å»\n4. åœ¨512å­—èŠ‚ä»¥å†…ï¼Œé€šè¿‡loaderåå­—æ‰¾åˆ°æ–‡ä»¶ï¼ŒåŠ è½½å…¨éƒ¨å†…å®¹åˆ°0x9000ï¼Œæœ€åjmp 0x9000\n\nå¿…é¡»çŸ¥é“çŸ¥è¯†ï¼š\n\nmountå‘½ä»¤èƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«FAT12æ–‡ä»¶ç³»ç»Ÿçš„è½¯ç›˜\nfreedosæ“ä½œç³»ç»Ÿæ ¼å¼åŒ–è½¯ç›˜ä¸ºFAT12æ–‡ä»¶ç³»ç»Ÿæ ¼å¼åï¼Œç¬¬ä¸€ä¸ªæ‰‡åŒºè‡ªåŠ¨è¢«è®¾ç½®ä¸ºå¯åŠ¨æ‰‡åŒº\nä»»ä½•å¯åŠ¨æ‰‡åŒºéƒ½è¦ä¾èµ–æ–‡ä»¶ç³»ç»Ÿï¼Œå“ªæ€•æ˜¯FAT32ä¹Ÿå­˜åœ¨å¯åŠ¨æ‰‡åŒº\n\nç¬¬äº”è¯¾ï¼šä¸»å¼•å¯¼ç¨‹åºçš„æ‰©å±•ï¼ˆä¸‹ï¼‰é—®é¢˜1ï¼šFAT12æ–‡ä»¶ç³»ç»Ÿé‡Œçš„æ–‡ä»¶ï¼Œæ•°æ®å­˜æ”¾ä¸ä¸€å®šæ˜¯è¿ç»­çš„ï¼Œé‚£è¦æ€ä¹ˆè·å¾—å®Œæ•´çš„æ–‡ä»¶æ•°æ®ï¼Ÿ\næ–¹æ³•ï¼šé€šè¿‡FATè¡¨æ¥æŸ¥æ‰¾ï¼ŒFATè¡¨æ¯ä¸€é¡¹è®°å½•ç€ä¸‹ä¸€ä¸ªåº”è¯¥è¯»å–çš„æ‰‡åŒºåœ°å€ï¼Œæœ€åä¸€é¡¹æ ‡è®°ä¸ºç‰¹æ®Šé¡¹ï¼Œè¡¨ç¤ºç»“æŸ\næµç¨‹ï¼šå‡è®¾ä¸€ä¸ªæ–‡ä»¶çš„èµ·å§‹æ‰‡åŒºåœ¨39æ‰‡åŒºï¼Œå®ƒçš„FATè¡¨é¡¹åœ¨2+6&#x3D;8ç´¢å¼•å¤„ï¼Œæ“ä½œç³»ç»Ÿåº”è¯¥å…ˆè¯»39æ‰‡åŒºå†…å®¹ï¼Œè¯»å®Œä¹‹åå»FATè¡¨çš„ç¬¬8é¡¹æŸ¥çœ‹æ˜¯ä¸æ˜¯ä¸ºæœ€åä¸€é¡¹ï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±è¯»è¿™ç¬¬8é¡¹é‡Œé¢çš„ä¿¡æ¯ï¼Œè¯»å‡ºæ¥å¦‚æœæ˜¯12ï¼Œåˆ™è¡¨ç¤ºæ“ä½œç³»ç»Ÿåº”è¯¥å»èµ·å§‹ç°‡å·ä¸º12çš„ä½ç½®è¯»æ•°æ®ï¼Œå¯¹åº”çš„ç‰©ç†èµ·å§‹åœ°å€ä¸ºï¼ˆ0x4200 + ï¼ˆ12-2ï¼‰*512 ï¼‰ï¼Œè¯»å®Œä¹‹åå†å»FATè¡¨æŸ¥çœ‹ç¬¬12é¡¹æ˜¯ä¸æ˜¯ä¸ºæœ€åä¸€é¡¹ï¼Œå‘¨è€Œå¤å§‹è¿›è¡Œè¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°è¯»å®Œä¸ºæ­¢\nå¿…é¡»çŸ¥é“çš„çŸ¥è¯†1ï¼š\n\nåœ¨FAT12æ–‡ä»¶ç³»ç»Ÿä¸‹ï¼Œç¬¬1ä¸ªæ‰‡åŒºæ˜¯ä¸»å¼•å¯¼ç¨‹åºï¼Œç¬¬19ä¸ªæ‰‡åŒºæ˜¯æ–‡ä»¶ç›®å½•é¡¹æ‰‡åŒº\n\nFAT12ç›®å½•åŒºé‡Œï¼Œå­˜æ”¾ç€å¤šä¸ªç›®å½•é¡¹ï¼Œæ¯ä¸ªç›®å½•é¡¹ç”±32ä¸ªå­—èŠ‚ç»„æˆï¼ˆå…³é”®ç‚¹æ˜¯è¦é‡Œé¢çš„åç§°ï¼Œèµ·å§‹åœ°å€ï¼Œæ–‡ä»¶å¤§å°ï¼‰\n\nåœ¨FAT12æ–‡ä»¶ç³»ç»Ÿé‡Œçš„æ–‡ä»¶ï¼Œæ•°æ®å­˜æ”¾ä¸ä¸€å®šæ˜¯è¿ç»­çš„ï¼Œä¸€ä¸ªæ–‡ä»¶å¯èƒ½åˆ†å¤šä¸ªæ‰‡åŒºå­˜å‚¨\n\nFATè¡¨ä¸­æ¯ä¸€ä¸ªé¡¹å ç”¨12bitsï¼Œè¡¨é¡¹å€¼å¤§äºç­‰äº0xFF8ï¼Œè¯´æ˜å·²ç»è¾¾åˆ°æœ€åä¸€ä¸ªæ‰‡åŒºï¼ˆä¸€ä¸ªç°‡ï¼‰\n\nFAT12æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªæ‰‡åŒºå¤§å°ç­‰äºä¸€ä¸ªç°‡çš„å¤§å°ï¼ˆé€šå¸¸æ¥è¯´ç°‡çš„æ¦‚å¿µæ¯”æ‰‡åŒºæ›´å¤§ï¼‰\n\næ•°æ®åŒºèµ·å§‹æ‰‡åŒºå·ä¸º33ï¼Œåœ°å€ä¸º0x4200ï¼Œå¯¹åº”çš„FATè¡¨çš„è¡¨é¡¹ç¼–å·ä¸º2ï¼ˆä¸ä¸º0ï¼‰ï¼šæ‰“ä¸ªæ¯”æ–¹ï¼Œä¸€ä¸ªæ–‡ä»¶çš„èµ·å§‹æ‰‡åŒºåœ¨39æ‰‡åŒºï¼Œå®ƒçš„FATè¡¨é¡¹åœ¨2+6&#x3D;8ç´¢å¼•å¤„ã€‚\n\nDIR_FstClusè¡¨ç¤ºFATè¡¨é¡¹çš„èµ·å§‹ä½ç½®ï¼ˆèµ·å§‹ç°‡å·ï¼Œä¸æ˜¯æ‰‡åŒºå·ï¼‰ï¼Œæ¯ä¸€ä¸ªæ–‡ä»¶éƒ½æœ‰ä¸€ä¸ªDIR_FstClus\n\næ‰€ä»¥ï¼ŒDIR_FstCIuså¯¹åº”çš„ç‰©ç†èµ·å§‹åœ°å€ä¸ºï¼ˆ0x4200 + ï¼ˆDIR_FstClus-2ï¼‰*512 ï¼‰\n\n\nå¿…é¡»çŸ¥é“çš„çŸ¥è¯†2ï¼š\n\nFAT12æ–‡ä»¶ç³»ç»Ÿå…¨å±€åˆ†å¸ƒå›¾\n\n**    **\n\nä¸€ä¸ªç›®å½•é¡¹ç»„æˆæˆåˆ†\n\n\nFATè¡¨å·¥ä½œç¤ºæ„å›¾\n\n\n\n\nç¬¬å…­è¯¾ï¼šçªç ´512å­—èŠ‚é™åˆ¶ï¼ˆä¸Šï¼‰é—®é¢˜1ï¼šä¸»å¼•å¯¼ç¨‹åºä¸­å¦‚ä½•è¿›è¡Œå­—ç¬¦ä¸²æ‰“å°ï¼Ÿ\næŒ‡å®šå‚æ•°ï¼ŒæŒ‡å®šå­—ç¬¦ä¸²çš„èµ·å§‹åœ°å€ï¼ŒæŒ‡å®šå­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œè¿›è¡Œç³»ç»Ÿè°ƒç”¨int 0x10\n\né—®é¢˜2ï¼šç¨‹åºä¸­å¦‚ä½•è¯»å–æ‰‡åŒºæ•°æ®ï¼Ÿ\næŒ‡å®šå¥½é€»è¾‘æ‰‡åŒºä½ç½®ï¼Œæ¯”å¦‚è¯´34å·æ‰‡åŒºï¼Œç»è¿‡ä¸€ç³»åˆ—é…ç½®ï¼ˆé€»è¾‘æ‰‡åŒºå·è½¬æ¢æˆç£å¤´å·ã€æŸ±é¢å·ã€æ‰‡åŒºå·ï¼‰ï¼Œè¿›è¡Œä¸­æ–­è°ƒç”¨int 0x13\n\n\né—®é¢˜3ï¼šç‰©ç†è½¯ç›˜çš„æŸ±é¢æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ\nä¸€ä¸ª3.5å¯¸è½¯ç›˜1.44Mï¼Œç”±ä¸¤ä¸ªç£å¤´ï¼Œæ¯ä¸ªç£å¤´å¯¹åº”ä¸€ä¸ªç›˜é¢ï¼Œä¸€ä¸ªç›˜é¢ä¸Šæœ‰å¾ˆå¤šåœ†åœˆï¼Œä¸¤ä¸ªåœ†åœˆç»„æˆä¸€ä¸ªæŸ±é¢ï¼Œä¸€ä¸ªæŸ±é¢ä¸Šæœ‰è‹¥å¹²ä¸ªæ‰‡åŒº\n\nå¿…é¡»çŸ¥é“çš„çŸ¥è¯†ï¼š\n\nFAT12æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶çš„å±æ€§ä¿¡æ¯ä¿å­˜åœ¨ç›®å½•é¡¹çš„32å­—èŠ‚ä¸­ï¼Œè€Œæ–‡ä»¶çš„dataæ˜¯èµ¤è£¸è£¸åœ°æ”¾åœ¨æ–‡ä»¶æ•°æ®æ‰‡åŒºä¸­\n512å­—èŠ‚çš„é™åˆ¶æ˜¯æŒ‡ä»£ç é‡é™åˆ¶æ˜¯512å­—èŠ‚ï¼Œè€Œä¸æ˜¯è¯´å®ƒçš„æ•°æ®åŒºå’Œä»£ç åŒºç­‰ç­‰åŠ èµ·æ¥æ˜¯512å­—èŠ‚ï¼Œåœ¨512å­—èŠ‚ä»¥å†…ï¼Œèƒ½ä½¿ç”¨çš„å†…å­˜å¯ä»¥æ›´å¤š\n\nç¬¬ä¸ƒè¯¾ï¼šçªç ´512å­—èŠ‚é™åˆ¶ï¼ˆä¸­ï¼‰é—®é¢˜1ï¼šå¦‚ä½•åŠ è½½æ ¹ç›®å½•åŒºåˆ°å†…å­˜ä¸­ï¼ˆç›´æ¥æŠŠå†…å­˜è¯»å‡ºæ¥å°±å¥½ï¼‰ï¼Œå¹¶ä¸”æŸ¥æ‰¾åˆ°ç›®æ ‡æ–‡ä»¶å‘¢ï¼Ÿ\nå­—ç¬¦ä¸²æ¯”è¾ƒï¼Œåªæ˜¯ç”¨æ±‡ç¼–è¯­è¨€å®ç°\né—®é¢˜2ï¼šå¦‚ä½•ä½¿ç”¨æ±‡ç¼–è¯­è¨€è¿›è¡Œå†…å­˜æ¯”è¾ƒå‘¢ï¼Ÿ\nç¬¬å…«è¯¾ï¼šçªç ´512å­—èŠ‚é™åˆ¶ï¼ˆä¸‹ï¼‰ç¬¬ä¹è¯¾ï¼šä¸»å¼•å¯¼ç¨‹åºæ§åˆ¶æƒçš„è½¬ç§»ç¬¬åè¯¾ï¼šå®æ¨¡å¼åˆ°ä¿æŠ¤æ¨¡å¼ï¼ˆä¸Šï¼‰ç¬¬åä¸€è¯¾ï¼šå®æ¨¡å¼åˆ°ä¿æŠ¤æ¨¡å¼ï¼ˆä¸­ï¼‰å¿…é¡»çŸ¥é“çš„çŸ¥è¯†ï¼š\næ±‡ç¼–è¯­è¨€ä¸­ï¼Œæ ‡ç­¾å¤„çš„åœ°å€ä»£è¡¨ç›¸å¯¹åœ°å€ï¼Œéœ€è¦é…åˆcså¯„å­˜å™¨ï¼Œæ‰èƒ½ç¡®å®šçœŸæ­£çš„ç‰©ç†åœ°å€ï¼ˆåˆå§‹åŒ–æ®µæè¿°ç¬¦çš„æ—¶å€™è¦ç”¨åˆ°è¿™ä¸ªçŸ¥è¯†ï¼‰\nç¬¬åäºŒè¯¾ï¼šå®æ¨¡å¼åˆ°ä¿æŠ¤æ¨¡å¼ï¼ˆä¸‹ï¼‰"},{"url":"/2026/02/27/2026-2-27-w25q128%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/","content":""},{"url":"/2026/02/11/lubancat2%E6%9B%B4%E6%96%B0%E5%86%85%E6%A0%B8%E6%96%B9%E6%B3%95/","content":"\né¦–å…ˆè¿›å…¥å†…æ ¸ç›®å½•ï¼Œmake menuconfigé…ç½®å¥½ï¼Œç„¶åå°†ç”Ÿæˆçš„.configæ–‡ä»¶ èµ‹å€¼ç»™lubancat2_defconfig\n\ncp .config arch/arm64/configs/lubancat2_defconfig\n\næˆ–è€…ç›´æ¥ make menuconfig KCONFIG_CONFIG&#x3D;arch&#x2F;arm64&#x2F;configs&#x2F;lubancat2_defconfig ARCH&#x3D;arm64\nåœ¨Ubuntu20ä¸­å’ŒUbuntu26ä¸­ä¸ä¸€æ ·\nubuntu20:\n\néœ€è¦å…ˆç¼–è¯‘å†…æ ¸.&#x2F;build.sh kernel\nå†ç¼–è¯‘debåŒ….&#x2F;build.sh kerneldeb\n\nubuntu26:\n\né¦–å…ˆå¿…é¡»å…ˆç¼–è¯‘.&#x2F;build.dh kernel\nç„¶åæ‰‹åŠ¨ç¼–è¯‘make dtbs\næœ€åæ‰§è¡Œsudo .&#x2F;build.sh kerneldeb\n\n"},{"url":"/2026/02/25/2026-2-25-%E6%AF%95%E8%AE%BE%E6%96%B9%E6%A1%88%E7%A1%AE%E5%AE%9A/","content":"é©±åŠ¨å·²ç»å®Œæˆï¼Œå‰©ä¸‹çš„å°±æ˜¯ç»„ç»‡è½¯ä»¶å†…å®¹\nè½¦è½½ç³»ç»ŸåŠŸèƒ½ï¼šéŸ³ä¹ï¼Œæ”¾è§†é¢‘ï¼ˆé€šè¿‡uç›˜è·å¾—éŸ³ä¹å’Œè§†é¢‘ï¼Œç„¶åæ”¾å‡ºæ¥ï¼Œè¦åšä¸€ä¸ªåˆ—è¡¨ï¼‰\nç¯å¢ƒæ£€æµ‹æ˜¾ç¤ºï¼šæ¸©åº¦ï¼ŒäºŒæ°§åŒ–ç¢³æµ“åº¦,TVOCï¼Œå…‰ç…§å¼ºåº¦\næ”¶éŸ³æœºåŠŸèƒ½ï¼šè°ƒé¢‘ç•Œé¢\nGPSå®šä½åŠŸèƒ½ï¼šèƒ½å¤Ÿæ˜¾ç¤ºå½“å‰ä½ç½®å³å¯\né¥æ§ç•Œé¢\nå‘½ä»¤ï¼šä¿®æ”¹ä¸ºæ¨ªå±ï¼ˆæ˜¾ç¤ºå’Œè§¦æ‘¸æ–¹å‘éƒ½è¦æ”¹ï¼‰DSI-1:mipiå±ï¼Œrightå¯ä»¥æ”¹ä¸ºleft\n#æ—‹è½¬å±å¹•-å‘å³90åº¦xrandr --output DSI-1 --rotate right#ä¿®æ”¹è§¦æ‘¸æ–¹å‘ï¼ˆå¯æ ¹æ®åå­—ä¿®æ”¹ï¼‰ å‘å³90åº¦xinput set-prop 10 &#x27;Coordinate Transformation Matrix&#x27; 0 1 0 -1 0 1 0 0 1  #æ—‹è½¬å±å¹•-å‘å·¦90åº¦xrandr --output DSI-1 --rotate left\n\n\n\nè¿è¡Œç¨‹åºå‘½ä»¤ï¼š\nLD_LIBRARY_PATH&#x3D;&#x2F;opt&#x2F;qt-everywhere-src-5.15.8&#x2F;ext&#x2F;lib .&#x2F;untitled1 -platform xcb\nç»å…¸æŠ¥é”™ï¼š&#x2F;home&#x2F;cat&#x2F;qt_files&#x2F;untitled1&#x2F;untitled1: error while loading shared libraries: libQt5QmlModels.so.5: cannot open shared object file: No such file or directory\nå»ç¯å¢ƒå˜é‡ä¸­æ·»åŠ ï¼ŒLD_LIBRARY_PATH&#x3D;&#x2F;opt&#x2F;qt-everywhere-src-5.15.8&#x2F;ext&#x2F;lib\n\né—®é¢˜1ï¼šdebian10ç³»ç»Ÿæ— æ³•å‡çº§å†…æ ¸ï¼ŒUbuntu20å°±å¯ä»¥\nä½†æ˜¯Ubuntu20çš„qtç¯å¢ƒæ²¡æ³•æ­å»ºå¥½\næš‚æ—¶çš„è§£å†³åŠæ³•ï¼šå…ˆåœ¨Ubuntu20ä¸Šï¼ˆSDå¡ç³»ç»Ÿä¸Šï¼‰è¿›è¡Œé©±åŠ¨ç¨‹åºçš„æµ‹è¯•\nâ€‹\t\t\t\tåœ¨debian10 ä¸Šå®Œå–„qtç¨‹åºï¼ˆå…ˆæŠŠåª’ä½“åŠŸèƒ½åšäº†ï¼‰\nè§£å†³åŠæ³•ï¼š\n\n\néœ€è¦å»æ‰å†…æ ¸é©±åŠ¨ï¼šUSB HID\næ·»åŠ å†…æ ¸é©±åŠ¨ï¼š GPIO- SPIæ§åˆ¶å™¨\nä¸es8311æœ‰å…³çš„ä¸€åˆ‡è®¾å¤‡æ ‘ï¼š\nsound {\n    status = &quot;okay&quot;;\n    compatible = &quot;simple-audio-card&quot;;\n    simple-audio-card,name = &quot;gundam-ES8311&quot;;\n    simple-audio-card,format = &quot;i2s&quot;;\n    simple-audio-card,mclk-fs = &lt;256&gt;;\n\n    simple-audio-card,cpu {\n        sound-dai = &lt;&amp;i2s3_2ch&gt;;\n    };\n\n    simple-audio-card,codec {\n        sound-dai = &lt;&amp;es8311&gt;;\n    };\n};\n\nâ€‹â€‹â€‹    &amp;i2s3_2ch {â€‹    \tstatus &#x3D; â€œokayâ€;â€‹    \tpinctrl-names &#x3D; â€œdefaultâ€;â€‹    \trockchip,clk-trcm &#x3D; &lt;1&gt;;â€‹    \tpinctrl-0 &#x3D; &lt;&amp;i2s3m1_sclkâ€‹    \t\t     &amp;i2s3m1_lrckâ€‹    \t\t     &amp;i2s3m1_sdiâ€‹    \t\t     &amp;i2s3m1_sdo&gt;;â€‹    };â€‹    \n&amp;i2c5{\n    status = &quot;disabled&quot;;\n    clock-frequency = &lt;400000&gt;;\n\tpinctrl-names = &quot;default&quot;;\n\tpinctrl-0 = &lt;&amp;i2c5m0_xfer&gt;;     //ä½¿ç”¨GPIO1_A1å’ŒGPIO1_A0å¤ç”¨ä¸ºI2C3å¼•è„š\n    #address-cells = &lt;1&gt;;\n    #size-cells = &lt;0&gt;;\n\n    es8311: es8311@11 {\n        status = &quot;disabled&quot;; \n        compatible = &quot;everest,es8311&quot;;\n        reg = &lt;0x11&gt;;\n\n        adc-pga-gain = &lt;6&gt;;\t/* 18dB */\n        adc-volume = &lt;0xbf&gt;;\t/* 0dB */\n        dac-volume = &lt;0xbf&gt;;\t/* 0dB */\n        aec-mode = &quot;dac left, adc right&quot;;\n        \n        clocks = &lt;&amp;cru I2S3_MCLKOUT&gt;;\n        clock-names = &quot;mclk&quot;;\n        assigned-clocks = &lt;&amp;cru I2S3_MCLKOUT&gt;, &lt;&amp;cru I2S3_MCLK_IOE&gt;;\n        assigned-clock-rates = &lt;12288000&gt;;\n        assigned-clock-parents = &lt;&amp;cru I2S3_MCLKOUT_TX&gt;, &lt;&amp;cru I2S3_MCLKOUT&gt;;\n\n        pinctrl-names = &quot;default&quot;;\n        pinctrl-0 = &lt;&amp;i2s3m1_mclk&gt;;\n        \n        /* å¿…é¡»ä¸ä¸»æ§ä¿æŒä¸€è‡´ */\n        dai-format = &quot;i2s&quot;;\n        dai-word-size = &lt;16&gt;;\n\n        #sound-dai-cells = &lt;0&gt;;\n    }; \n};\n\nâ€‹â€‹â€‹â€‹    \n"},{"title":"GT911åœ¨RK3568ä¸Šçš„è°ƒè¯•è®°å½•","url":"/2026/02/09/2026-2-9-GT911%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/","content":"GT911é‡è¦å¯„å­˜å™¨æ§åˆ¶å¯„å­˜å™¨ï¼š0x8040\né…ç½®å¯„å­˜å™¨ï¼ˆç»„ï¼‰ï¼š0x8047-0x8100\nçŠ¶æ€å¯„å­˜å™¨ï¼š0x814E\nåæ ‡å¯„å­˜å™¨ï¼ˆç»„ï¼‰ï¼š0x8150-0x8177\n\n\nç¡¬ä»¶è®¾æ–½å‡†å¤‡é€šè¿‡å‘½ä»¤è¡Œè¾“å…¥ i2cdetect -y 1 ï¼Œå¯ä»¥æ£€æµ‹i2c1æ€»çº¿ä¸‹æ‰€æœ‰è®¾å¤‡çš„è®¾å¤‡åœ°å€\né²ç­çŒ«2ä¸Šè§¦æ‘¸å±æ¥å£\nä¸­æ–­å¼•è„šæ˜¯GPIO0_B5\nå¤ä½å¼•è„šæ˜¯GPIO0_B6\n\nå¯¹GT911çš„æ“ä½œæ–¹æ³•\nè¯»æ“ä½œæ—¶åºå›¾ï¼Œé«˜ä½å…ˆè¡Œï¼Œä½ä½åœ¨å\n\n\n\nå†™i2cé€šä¿¡æ¡†æ¶ï¼Œèƒ½å¤Ÿè¯»åˆ°GT911èŠ¯ç‰‡çš„IDå·ï¼ˆéœ€è¦å‚è€ƒæ‰‹å†Œï¼Œçœ‹çœ‹IDå·åœ¨å“ªä¸ªå¯„å­˜å™¨é‡Œï¼‰\n\nåæ ‡å¯„å­˜å™¨ä¸­å«æœ‰Product IDä¿¡æ¯ï¼Œè¯»å‡ºæ¥å¾ˆæœ‰å¯èƒ½æ˜¯â€œ911â€\n\n\nç¡®è®¤ä¸­æ–­å‘ç”Ÿçš„æ–¹å¼ï¼ˆæŸ¥è¯¢æ‰‹å†Œï¼‰\n\nGT911æœ‰ä¸¤ä¸ªåœ°å€å¯é€‰ï¼Œä»¥ä¸‹æ˜¯æŠŠåœ°å€è®¾ç½®ä¸º0x14çš„æ–¹æ³•ï¼Œå¯¹åº”çš„8ä½åœ°å€æ˜¯0x28\n\n\nä»¥ä¸‹æ˜¯è®¾ç½®åœ°å€ä¸º0x5Dçš„æ–¹æ³•ï¼Œæœ¬æ¬¡è°ƒè¯•åªé€‰0x14\n\nè®¾å¤‡æ ‘é—®é¢˜é—®é¢˜1:ï¼šg_GT911_dev.reset_gpio &#x3D; gpiod_get_optional(&amp;client-&gt;dev, â€œresetâ€, GPIOD_OUT_LOW);ç”³è¯·å¤±è´¥ï¼Œè¿”å›çš„æ˜¯NULLï¼Œè®¾å¤‡æ ‘ä¸­å·²ç»æŒ‡å®šreset-gpios &#x3D; &lt;&amp;gpio0 RK_PB6 GPIO_ACTIVE_HIGH&gt;;å‘ç°ä¸æ˜¯é—®é¢˜ï¼Œæ˜¯å› ä¸ºæˆ‘è°ƒç”¨äº†ä¸¤æ¬¡ gpiod_get_optional(&amp;client-&gt;dev, â€œresetâ€, 0);å¯¼è‡´çš„å“ˆå“ˆ\né—®é¢˜2ï¼šæ€ä¹ˆæŸ¥çœ‹æŸä¸€ä¸ªå¼•è„šè¢«å¤ä½æˆäº†ä»€ä¹ˆåŠŸèƒ½å‘¢ï¼Ÿæ–¹æ³•1ï¼šæŸ¥çœ‹GPIOçš„å¤ç”¨åŠŸèƒ½ï¼ˆmux functionï¼‰\ncat /sys/kernel/debug/pinctrl/pinctrl-rockchip-pinctrl/pinmux-pins\n\næ–¹æ³•2ï¼šæŸ¥çœ‹gpioçš„labelè¿˜æœ‰åŠŸèƒ½\ncat /sys/kernel/debug/gpio   \n\næ–¹æ³•3ï¼šæŸ¥çœ‹i2cè®¾å¤‡ä¸­ï¼Œ0x5dè¿™ä¸ªè®¾å¤‡æ˜¯ç»‘å®šåˆ°å“ªä¸ªé©±åŠ¨ç¨‹åºä¸Šäº†\ncat /sys/bus/i2c/devices/1-0014/uevent 2&gt;/dev/null \n\né—®é¢˜3ï¼šä¸ºä»€ä¹ˆæˆ‘ä¸€åœ¨è®¾å¤‡æ ‘ä¸­æ·»åŠ  irq-gpios   &#x3D; &lt;&amp;gpio0 RK_PB5 GPIO_ACTIVE_HIGH&gt;;ï¼Œå°±æ— æ³•è¿›è¡Œprobeå‡½æ•°äº†ï¼Ÿæ— æ³•å’Œé©±åŠ¨è¿›è¡ŒåŒ¹é…â€‹\t\tæ·»åŠ è¿™ä¸¤ä¸ªéƒ½ä¸ä¼šæœ‰é—®é¢˜\nâ€‹\t\t\tinterrupt-parent &#x3D; &lt;&amp;gpio0&gt;;â€‹\t\t\tinterrupts &#x3D; ;\n\nè®¾å¤‡æ ‘ä¸­ï¼Œæ·»åŠ äº†irq-gpios ç»“ç‚¹åï¼Œåªèƒ½ä½¿ç”¨regä¸º0x5dï¼Œ0x14ç”¨ä¸äº†\nè®¾ä¸º0x5dä¹‹åï¼Œåªèƒ½ä½¿ç”¨irq-gpios   &#x3D; &lt;&amp;gpio0 RK_PB5 GPIO_ACTIVE_LOW&gt;;æ‰èƒ½ä¸æˆ‘çš„é©±åŠ¨ç¨‹åºåŒ¹é…ï¼Œirq-gpios   &#x3D; &lt;&amp;gpio0 RK_PB5 GPIO_ACTIVE_HIGH&gt;;ä½¿ç”¨åå°±æ— æ³•ä½¿ç”¨è°ƒç”¨probeå‡½æ•°ï¼Œå¾ˆå¥‡æ€ªã€‚ã€‚ã€‚\nä»¥ä¸Šå¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜\néƒ½æ˜¯ç”±äºæˆ‘è‡ªå·±å†™çš„è®¾å¤‡æ ‘ï¼ŒåŒ¹é…ä¸Šäº†å†…æ ¸çš„é©±åŠ¨ç¨‹åºgoodix.cï¼ˆä½†æ˜¯ï¼Œæˆ‘çš„compatibleå­—ç¬¦ä¸²å’Œå†…æ ¸é©±åŠ¨ç¨‹åºçš„compatibleå­—ç¬¦ä¸²å¹¶ä¸ä¸€æ ·ï¼Œé€—å·å‰é¢çš„å†…å®¹ä¸ä¸€æ ·ï¼Œä½†æ˜¯é€—å·åé¢çš„å†…å®¹éƒ½æ˜¯gt911ï¼‰\nï¼ˆç¬¬ä¸‰ä¸ªé—®é¢˜ï¼šå› ä¸ºå†…æ ¸çš„gt911é©±åŠ¨ç¨‹åºæ¥ç®¡äº†è¿™ä¸ªè®¾å¤‡æ ‘ï¼Œå¹¶ä¸”é¡ºåˆ©åœ°åˆå§‹åŒ–äº†ï¼Œå¯¼è‡´æˆ‘è‡ªå·±çš„é©±åŠ¨åŠ è½½åï¼Œæ— æ³•ä¸è®¾å¤‡æ ‘ç»“ç‚¹åŒ¹é…ï¼‰\nï¼ˆç¬¬å››ä¸ªé—®é¢˜ï¼šæ˜¯å› ä¸ºå†…æ ¸é©±åŠ¨ç¨‹åºï¼Œå¯ä»¥æ ¹æ®regå±æ€§ï¼Œé…ç½®gt911çš„åœ°å€ï¼Œè€Œä¸”GPIO_ACTIVE_HIGHå’ŒLOWè®¾ç½®çš„ä¸æ­£ç¡®ï¼Œä¹Ÿä¼šæœ‰å½±å“ï¼Œå½±å“é©±åŠ¨è®¾ç½®gt911åœ°å€è¿‡ç¨‹ï¼‰\nï¼ˆç¬¬äº”ä¸ªé—®é¢˜ï¼šå› ä¸ºå¦‚æœè®¾ä¸ºLOWï¼Œåœ¨å†…æ ¸gt911é©±åŠ¨ç¨‹åºæƒ³è¦è®¾ç½®gt911çš„è®¾å¤‡åœ°å€æ—¶ï¼Œé«˜ä½ç”µå¹³æœ‰è¯¯ï¼Œç„¶åæ— æ³•è®¾ç½®ï¼Œå¯¼è‡´probeå‡½æ•°ç›´æ¥è¿”å›äº†ï¼Œprobeå‡½æ•°é”™è¯¯è¿”å›ï¼Œå°±ä¼šå¯¼è‡´ä¸ä¹‹åŒ¹é…çš„è®¾å¤‡æ ‘ç»“ç‚¹è¢«é‡Šæ”¾ï¼Œè¢«é‡Šæ”¾ä¹‹åï¼Œæˆ‘çš„é©±åŠ¨ç¨‹åºå°±èƒ½è¢«åŠ è½½äº†ï¼Œæ˜¯è¿™æ ·ä¸€ä¸ªè¿‡ç¨‹ï¼‰\n\n\n\n\n\n\n\nè®¾å¤‡æ ‘é—®é¢˜è§£å†³æ˜¯å› ä¸ºiicæ€»çº¿åŒ¹é…åŸåˆ™ï¼ŒåŒæ„åªåŒ¹é…é€—å·ä¹‹åçš„å­—ç¬¦ä¸²\nçº¿ç´¢ï¼šæˆ‘å»å†…æ ¸çœ‹äº†ä¸€ä¸‹ï¼Œå‘ç°è¿™é‡Œå¯¹é€—å·è¿›è¡Œäº†æ“ä½œï¼Œå°±æ˜¯æŠŠé€—å·åé¢çš„å­—ç¬¦ä¸²ï¼Œå½“æˆè¿™ä¸ªi2cè®¾å¤‡çš„åå­—äº†\n\nè¿™ä¸ªæ˜¯i2cæœ€å¤–å±‚çš„åŒ¹é…å‡½æ•°ï¼Œæ¡†èµ·æ¥çš„é‚£ä¸ªæœ¬æ¥å°±æ˜¯ç”¨æ¥åŒ¹é…å…¨éƒ¨å­—ç¬¦ä¸²çš„\n\ni2cæ€»çº¿ç›¸æ¯”æœ€æ™®é€šçš„é‚£ä¸ªplatformå¹³å°æ€»çº¿ï¼Œå¤šäº†è¿™ä¸ªåå­—åŒ¹é…\n\n\nä¸­æ–­ä¸åœè§¦å‘é—®é¢˜é—®é¢˜1ï¼šåŠ è½½é©±åŠ¨åï¼Œå•¥ä¹Ÿæ²¡åšå°±ä¸€ç›´è¿›ä¸­æ–­ï¼Œä¸­æ–­æœåŠ¡ç¨‹åºä¸åœæ‰“å°ä¸œè¥¿è§£å†³åŠæ³•1ï¼šé¦–å…ˆéœ€è¦è¯»å–åæ ‡ï¼Œç„¶åå¯¹0x814Eå†™0ï¼ˆç±»ä¼¼æ¸…é™¤æ ‡å¿—ä½ï¼‰\nå¯„å­˜å™¨ä¿¡æ¯å¦‚ä¸‹\n\nè¿™ä¸¤ä¸ªæ­¥éª¤ç¼ºä¸€ä¸å¯ã€‚è€Œä¸”åªèƒ½åœ¨å·¥ä½œé˜Ÿåˆ—ä¸­è¿™ä¹ˆå¹²ï¼ˆå‚è€ƒGT911ç¼–ç¨‹æŒ‡å—.pdfï¼‰\né—®é¢˜2ï¼šåœ¨ä¸­æ–­æœåŠ¡ç¨‹åºé‡Œå†™å¯„å­˜å™¨æ²¡ç”¨ï¼Œä¼šå†™ä¸æˆåŠŸï¼Œä½†æ˜¯åœ¨å·¥ä½œé˜Ÿåˆ—ä¸­å†™å°±å¯ä»¥è§£å†³åŠæ³•1ï¼š\né¦–å…ˆè¦çŸ¥é“ï¼š\n1. ä¸­æ–­æœåŠ¡ç¨‹åºä¸å…è®¸æœ‰é˜»å¡çš„æ“ä½œ\n1. i2cè¯»å†™æ“ä½œi2c_transferé€šå¸¸ä¾èµ–ç­‰å¾…é˜Ÿåˆ—ã€ä¿¡zå·é‡ç­‰æœºåˆ¶\n\nå› æ­¤ä¸èƒ½åœ¨ä¸­æ–­æœåŠ¡ä¸­è¿›è¡Œè¯»å†™æ“ä½œ\né—®é¢˜3ï¼šå¸è½½é©±åŠ¨ç¨‹åºåï¼Œé‡æ–°åŠ è½½æ—¶æ— æ³•ç”³è¯·ä¸­æ–­ç°è±¡ï¼š\nç¬¬ä¸€æ¬¡åŠ è½½é©±åŠ¨çš„æ—¶å€™ï¼Œclient-&gt;irqæ—¶æ­£å¸¸çš„ç­‰äº111ï¼Œå¸è½½é©±åŠ¨ç¨‹åºåé‡æ–°åŠ è½½ï¼Œclient-&gt;irqå°±å˜æˆ0äº†\nAIç»™ç­”æ¡ˆï¼šæ„å‘³ç€ä½ å½“å‰ä½¿ç”¨çš„å†…æ ¸ç‰ˆæœ¬è¾ƒæ—§ã€‚Linuxå†…æ ¸åœ¨é©±åŠ¨å¸è½½æ—¶ä¼šä¸»åŠ¨å°† i2c_client ä¸­çš„ irq æˆå‘˜æ¸…é›¶\næˆ‘å‘ç°ï¼Œclient-&gt;init_irqåœ¨ç¬¬ä¸€ æ¬¡åŠ è½½é©±åŠ¨çš„æ—¶å€™å°±æ˜¯0ï¼Œè€Œclient-&gt;irq &#x3D; 111\nä½†æ˜¯åœ¨i2cå¹³å°çš„i2c_device_removeå‡½æ•°é‡Œï¼ˆå¸è½½é©±åŠ¨ç¨‹åºçš„æ—¶å€™ä¼šè°ƒç”¨ï¼‰ï¼Œæœ‰ä¸€è¡Œä»£ç \nclient-&gt;irq = client-&gt;init_irq;\n\nè¿™æ ·å°±æŠŠclient-&gt;irqå˜æˆ0äº†\nä½†æ˜¯i2c_device_probeé‡Œï¼Œå½“client-&gt;irq&#x3D;0æ—¶ï¼Œæœ‰å°è¯•é‡æ–°å»è§£æè®¾å¤‡æ ‘å•Š\n è§£å†³æ–¹æ³•1ï¼šä½¿ç”¨gpiod_to_irq(g_GT911_dev.irq_gpio);è·å–ä¸­æ–­å·\nå¦‚ä½•åˆ¤æ–­æ¾æ‰‹å’ŒæŒ‰ä¸‹ä½¿ç”¨ä»¥ä¸‹å¯„å­˜å™¨çš„ä½å››ä½ï¼ˆbit0~3ï¼‰\n\nbit0~3å¦‚æœä¸º0ï¼Œè¡¨ç¤ºæ¾æ‰‹ï¼Œå¯ä»¥è¿›è¡Œä¸ŠæŠ¥æ¾æ‰‹æ•°æ®\n","categories":["Linux I2Cé©±åŠ¨"],"tags":["I2C"]},{"title":"USBåŸºç¡€çŸ¥è¯†","url":"/2026/02/05/2026-2-8-usb%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/","content":"è®¾å¤‡æšä¸¾é˜¶æ®µ-usbè®¾å¤‡æ’å…¥ç”µè„‘åä¼šåšçš„äº‹æƒ…\n\n\nå½“ä¸€ä¸ªusbè®¾å¤‡ï¼Œæ¯”å¦‚è¯´uç›˜ï¼Œæ’åˆ°Linuxæ¿å­é‡Œåï¼Œå®ƒçš„åœ°å€ä¼šè¢«å¼ºåˆ¶é…ç½®æˆ0ï¼Œpcä¸çŸ¥é“è¿™ä¸ªè®¾å¤‡çš„å…·ä½“åœ°å€ï¼Œå°±ä¼šå»0åœ°å€å¤„å¯»æ‰¾ï¼Œåˆå› ä¸ºæ•´ä¸ªusbé“¾è·¯ä¸Šåªæœ‰è¿™ä¸ªæ–°åŠ å…¥çš„usbè®¾å¤‡åœ°å€æ˜¯0ï¼Œæ‰€ä»¥å°±å¯ä»¥ä»¥æ­¤è®¿é—®å®ƒ\n\né€šè¿‡å¯¹0åœ°å€çš„é…ç½®ï¼Œè¯»å–ï¼Œpcä¼šä¸ºè¿™ä¸ªæ–°åŠ å…¥çš„è®¾å¤‡åˆ†é…ä¸€ä¸ªidå·ï¼ˆæ¯ä¸€ä¸ªusbè®¾å¤‡æœ‰ä¸€ä¸ªidå·ï¼ŒèŒƒå›´æ˜¯1-127ï¼‰\n\nè¿™ä¸ªè¢«åˆ†é…å‡ºæ¥çš„idå·ï¼Œå°±æ˜¯ä»¤ç‰ŒåŒ…ã€æ•°æ®åŒ…é‡Œçš„7ä¸ºåœ°å€ï¼ç³»ç»Ÿé€šè¿‡è¿™ä¸ªåœ°å€å¯»æ‰¾åˆ°è®¾å¤‡ï¼\n\n\nå…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼šUSBè®¾å¤‡æ’å…¥æ¿å¡åï¼ŒLinuxç³»ç»Ÿä¼šåšçš„äº‹æƒ…\nUSBæ¥å£ä¸¤æ ¹çº¿ç”µå¹³å‘ç”Ÿå˜æ¢ï¼Œä¼šè¢«å†…æ ¸usbæ§åˆ¶å™¨é©±åŠ¨ç¨‹åºæ„ŸçŸ¥åˆ°ï¼Œåœ¨hub_threadä¸­å»è¯»å–è®¾å¤‡æè¿°ç¬¦ï¼Œé…ç½®æè¿°ç¬¦\n\né€šè¿‡è¯»å–åˆ°çš„è®¾å¤‡æè¿°ç¬¦ï¼Œé…ç½®æè¿°ç¬¦ï¼Œusbæ§åˆ¶å™¨é©±åŠ¨ç¨‹åºå°±çŸ¥é“è¿™ä¸ªè®¾å¤‡æ˜¯ä»€ä¹ˆè®¾å¤‡\n\nç³»ç»Ÿä¼šæ ¹æ®ä¹‹å‰è·å¾—çš„ â€œä¸‰è¦ç´ â€ï¼ˆç±»ä»£ç ã€å‚å•†IDã€äº§å“IDï¼‰ï¼Œå»åŒ¹é…è¢«ç¼–è¯‘è¿›å†…æ ¸çš„é©±åŠ¨ç¨‹åº\n\nåŒ¹é…åˆ°é©±åŠ¨åï¼Œåœ¨probeå‡½æ•°é‡Œå¯èƒ½ä¼šå»åšå„ç§äº‹æƒ…ï¼Œæ¯”å¦‚è¯´æ³¨å†Œè¿›inputå­ç³»ç»Ÿï¼Œæˆ–è€…ä½œä¸ºå—è®¾å¤‡ï¼ˆuç›˜ï¼‰æ³¨å†Œï¼Œæ³¨å†Œä½¿ç”¨æ¥å£\n\n\n","categories":["Linux USBé©±åŠ¨"],"tags":["USB"]},{"title":"inputå­ç³»ç»Ÿ","url":"/2026/02/09/2026-2-9-input%E5%AD%90%E7%B3%BB%E7%BB%9F/","content":"è¾“å…¥å­ç³»ç»Ÿ-inputå…³é”®æ•°æ®ç»“æ„struct input_dev &#123;\tconst char *name;\t\t\t\t\t// è®¾å¤‡åå­—ï¼ˆéœ€è¦ï¼‰\tconst char *phys;\t\t\t\t\t// è®¾å¤‡çš„ç‰©ç†è·¯å¾„åå­—ï¼Ÿï¼ˆä¸é‡è¦ï¼‰\tconst char *uniq;\t\t\t\t\t// è®¾å¤‡çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆä¸é‡è¦ï¼‰\tstruct input_id id;\t\t\t\t\t// è®¾å¤‡IDï¼ˆä¸é‡è¦ï¼‰\tunsigned long propbit[BITS_TO_LONGS(INPUT_PROP_CNT)];\t// è®¾å¤‡å±æ€§ä½å›¾ï¼ˆæ¯”è¾ƒå¤æ‚ï¼‰    \t/* è¡¨ç¤ºè¿™ä¸ªè®¾å¤‡èƒ½å¤Ÿä¸ŠæŠ¥å“ªäº›ç±»å‹çš„äº‹ä»¶ï¼Œä½¿ç”¨å‰éœ€è¦æå‰é…ç½®å¥½ */\tunsigned long evbit[BITS_TO_LONGS(EV_CNT)];\t\t// äº‹ä»¶ç±»å‹ä½å›¾ï¼ˆé‡è¦ï¼‰\tunsigned long keybit[BITS_TO_LONGS(KEY_CNT)];\t\t// äº‹ä»¶ç ä½å›¾ï¼ˆé‡è¦ï¼‰\tunsigned long relbit[BITS_TO_LONGS(REL_CNT)];\t\t// ç›¸å¯¹åæ ‡äº‹ä»¶ç ä½å›¾ï¼ˆå¦‚ä½•ä½¿ç”¨ï¼Ÿï¼‰\tunsigned long absbit[BITS_TO_LONGS(ABS_CNT)];\t\t// ç»å¯¹åæ ‡äº‹ä»¶ç ï¼ˆé‡è¦ï¼‰\tunsigned long mscbit[BITS_TO_LONGS(MSC_CNT)];\t\t// æ‚é¡¹äº‹ä»¶ä½å›¾ï¼ˆå¦‚ä½•ä½¿ç”¨ï¼Ÿï¼‰\tunsigned long ledbit[BITS_TO_LONGS(LED_CNT)];\t\t// LEDæŒ‡ç¤ºç¯ä½å›¾ï¼ˆå¦‚ä½•ä½¿ç”¨ï¼Ÿï¼‰\tunsigned long sndbit[BITS_TO_LONGS(SND_CNT)];\t\t// å£°éŸ³äº‹ä»¶ä½å›¾ï¼ˆå¦‚ä½•ä½¿ç”¨ï¼Ÿï¼‰\tunsigned long ffbit[BITS_TO_LONGS(FF_CNT)];\t\t// åŠ›åé¦ˆäº‹ä»¶ä½å›¾ï¼ˆæ¸¸æˆæ‰‹æŸ„éœ‡åŠ¨ï¼Ÿï¼‰\tunsigned long swbit[BITS_TO_LONGS(SW_CNT)];\t\t// å¼€å…³äº‹ä»¶ä½å›¾ï¼ˆé‡è¦ï¼‰        struct input_absinfo *absinfo;\t\t\t\t// ç»å¯¹åæ ‡äº‹ä»¶çš„ä¿¡æ¯é…ç½®        struct input_mt *mt;\t\t\t\t\t// ç”¨äºå¤šç‚¹è§¦æ‘¸ç®¡ç†        struct device dev;\t\t\t\t\t// è¡¨ç¤ºinputæ¡†æ¶æ‰€ç»‘å®šçš„ç‰©ç†è¾“å…¥è®¾å¤‡    \tunsigned long key[BITS_TO_LONGS(KEY_CNT)];\t\t// æŒ‰é”®çŠ¶æ€ä½å›¾ï¼Œæè¿°æŒ‰é”®æ˜¯å¦æŒ‰ä¸‹\tunsigned long led[BITS_TO_LONGS(LED_CNT)];\t\t// åŒç†\tunsigned long snd[BITS_TO_LONGS(SND_CNT)];\t\t// åŒç†\tunsigned long sw[BITS_TO_LONGS(SW_CNT)];\t\t// åŒç†    \t/* å†…æ ¸è‡ªåŠ¨ç®¡ç†ï¼ŒAPPä½¿ç”¨ */\tint (*open)(struct input_dev *dev);\tvoid (*close)(struct input_dev *dev);\tint (*flush)(struct input_dev *dev, struct file *file);\tint (*event)(struct input_dev *dev, unsigned int type, unsigned int code, int value);    /*********************ä»¥ä¸‹ä¸æ˜¯ç‰¹åˆ«é‡è¦ï¼Œå¤§éƒ¨åˆ†å±äºå†…æ ¸è‡ªåŠ¨ç®¡ç†*******************/    .......&#125;;\n\n","categories":["Linux I2Cé©±åŠ¨"],"tags":["I2C"]}]